<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">

<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="share something">
<meta property="og:type" content="website">
<meta property="og:title" content="Litost&#39;s Blog">
<meta property="og:url" content="http://litost-fht.top/index.html">
<meta property="og:site_name" content="Litost&#39;s Blog">
<meta property="og:description" content="share something">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Litost&#39;s Blog">
<meta name="twitter:description" content="share something">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://litost-fht.top/">





  <title>Litost's Blog</title>
  








</head>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":true,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":100,"height":200},"mobile":{"show":false},"log":false});</script> 
<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/llitost"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Litost's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/28/Machine Learning/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/28/Machine Learning/" itemprop="url">Machine Learning笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-28T19:42:50+08:00">
                2019-01-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/28/Machine Learning/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/28/Machine Learning/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  55
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="第一周"><a href="#第一周" class="headerlink" title="第一周"></a>第一周</h1><h2 id="What-is-Machine-Learning"><a href="#What-is-Machine-Learning" class="headerlink" title="What is Machine Learning?"></a>What is Machine Learning?</h2><p>​    Two definitions of Machine Learning are offered. Arthur Samuel described it as: “<strong>the field of study that gives computers the ability to learn without being explicitly programmed.</strong>“ This is an older, informal definition.</p>
<p>​    Tom Mitchell provides a more modern definition: “<strong>A computer program is said to learn from experience E with respect to some class of tasks T and performance measure P, if its performance at tasks in T, as measured by P, improves with experience E.</strong>“</p>
<p>Example: playing checkers.</p>
<p>​    E = the experience of playing many games of checkers</p>
<p>​    T = the task of playing checkers.</p>
<p>​    P = the probability that the program will win the next game.</p>
<p>​    In general, any machine learning problem can be assigned to one of two broad classifications:</p>
<p><strong>Supervised learning </strong>and <strong>Unsupervised learning</strong>.</p>
<h2 id="Supervised-Learning"><a href="#Supervised-Learning" class="headerlink" title="Supervised Learning"></a>Supervised Learning</h2><p>​    In supervised learning, we are given a data set and already know what our correct output should look like, having the idea that there is a relationship between the input and the output.</p>
<p>​    Supervised learning problems are categorized into “regression” and “classification” problems. In a regression problem, we are trying to predict results within a continuous output, meaning that we are trying to map input variables to some continuous function. In a classification problem, we are instead trying to predict results in a discrete output. In other words, we are trying to map input variables into discrete categories.</p>
<p><strong>Example 1:</strong></p>
<p>​    Given data about the size of houses on the real estate market, try to predict their price. Price as a function of size is a continuous output, so this is a regression problem.</p>
<p>​    We could turn this example into a classification problem by instead making our output about whether the house “sells for more or less than the asking price.” Here we are classifying the houses based on price into two discrete categories.</p>
<p><strong>Example 2</strong>:</p>
<p>​    (a) Regression - Given a picture of a person, we have to predict their age on the basis of the given picture</p>
<p>​    (b) Classification - Given a patient with a tumor, we have to predict whether the tumor is malignant or benign.</p>
<h2 id="Unsupervised-Learning"><a href="#Unsupervised-Learning" class="headerlink" title="Unsupervised Learning"></a>Unsupervised Learning</h2><p>​    Unsupervised learning allows us to approach problems with little or no idea what our results should look like. We can derive structure from data where we don’t necessarily know the effect of the variables.</p>
<p>​    We can derive this structure by clustering the data based on relationships among the variables in the data.</p>
<p>​    With unsupervised learning there is no feedback based on the prediction results.</p>
<p><strong>Example:</strong></p>
<p>​    Clustering: Take a collection of 1,000,000 different genes, and find a way to automatically group these genes into groups that are somehow similar or related by different variables, such as lifespan, location, roles, and so on.</p>
<p>​    Non-clustering: The “Cocktail Party Algorithm”, allows you to find structure in a chaotic environment. (i.e. identifying individual voices and music from a mesh of sounds at a cocktail party).</p>
<h2 id="Model-Representation"><a href="#Model-Representation" class="headerlink" title="Model Representation"></a>Model Representation</h2><p>​    To establish notation for future use, we’ll use $x^{(i)}$to denote the “input” variables (living area in this example), also called input features, and $y^{(i)}$ to denote the “output” or target variable that we are trying to predict (price). A pair $(x^{(i)} , y^{(i)} ) $is called a training example, and the dataset that we’ll be using to learn—a list of m training examples (<em>x</em>(<em>i</em>),<em>y</em>(<em>i</em>));<em>i</em>=1,…,<em>m</em>—is called a training set. Note that the superscript “(i)” in the notation is simply an index into the training set, and has nothing to do with exponentiation. We will also use X to denote the space of input values, and Y to denote the space of output values. In this example, X = Y = ℝ.</p>
<p>​    To describe the supervised learning problem slightly more formally, our goal is, given a training set, to learn a function h : X → Y so that h(x) is a “good” predictor for the corresponding value of y. For historical reasons, this function h is called a hypothesis. Seen pictorially, the process is therefore like this:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/H6qTdZmYEeaagxL7xdFKxA_2f0f671110e8f7446bb2b5b2f75a8874_Screenshot-2016-10-23-20.14.58.png?expiry=1547596800000&amp;hmac=VMM67_jkIOGw1bfoTjr0GJteQRxf8Lrs8ZT1z9tLR8w" alt="img"></p>
<p>​    When the target variable that we’re trying to predict is continuous, such as in our housing example, we call the learning problem a regression problem. When y can take on only a small number of discrete values (such as if, given the living area, we wanted to predict if a dwelling is a house or an apartment, say), we call it a classification problem.</p>
<h2 id="Gradient-Descent"><a href="#Gradient-Descent" class="headerlink" title="Gradient Descent"></a>Gradient Descent</h2><p>​    So we have our hypothesis function and we have a way of measuring how well it fits into the data. Now we need to estimate the parameters in the hypothesis function. That’s where gradient descent comes in.</p>
<p>​    Imagine that we graph our hypothesis function based on its fields $\theta_0$ and$ \theta_1​$(actually we are graphing the cost function as a function of the parameter estimates). We are not graphing x and y itself, but the parameter range of our hypothesis function and the cost resulting from selecting a particular set of parameters.</p>
<p>​    We put $\theta_0$ on the x axis and $\theta_1$on the y axis, with the cost function on the vertical z axis. The points on our graph will be the result of the cost function using our hypothesis with those specific theta parameters. The graph below depicts such a setup.</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/bn9SyaDIEeav5QpTGIv-Pg_0d06dca3d225f3de8b5a4a7e92254153_Screenshot-2016-11-01-23.48.26.png?expiry=1547596800000&amp;hmac=-ur9fV-YVNMKe7k_3EVBDwOdRx78ISkAxvZ3XBL0KGw" alt="img"></p>
<p>​    We will know that we have succeeded when our cost function is at the very bottom of the pits in our graph, i.e. when its value is the minimum. The red arrows show the minimum points in the graph.</p>
<p>​    The way we do this is by taking the derivative (the tangential line to a function) of our cost function. The slope of the tangent is the derivative at that point and it will give us a direction to move towards. We make steps down the cost function in the direction with the steepest descent. The size of each step is determined by the parameter α, which is called the learning rate.</p>
<p>​    For example, the distance between each ‘star’ in the graph above represents a step determined by our parameter α. A smaller α would result in a smaller step and a larger α results in a larger step. The direction in which the step is taken is determined by the partial derivative of J($\theta_0$,$\theta_1$). Depending on where one starts on the graph, one could end up at different points. The image above shows us two different starting points that end up in two different places.</p>
<p>​    The gradient descent algorithm is:</p>
<p>​    repeat until convergence:</p>
<p>​    $\theta_j := \theta_j - \alpha \frac{\partial}{\partial \theta_j} J(\theta_0, \theta_1)​$</p>
<p>​    where</p>
<p>​    j=0,1 represents the feature index number.</p>
<p>​    At each iteration j, one should simultaneously update the parameters $\theta_1$, $\theta_2$,…,$\theta_n$. Updating a specific parameter prior to calculating another one on the$ j^{(th)}$ iteration would yield to a wrong implementation.</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/yr-D1aDMEeai9RKvXdDYag_627e5ab52d5ff941c0fcc741c2b162a0_Screenshot-2016-11-02-00.19.56.png?expiry=1547596800000&amp;hmac=lST2n9B7tGWE6RGAcqU_zu9R6c-4frwT613MKfaGNN0" alt="img"></p>
<h1 id="第二周"><a href="#第二周" class="headerlink" title="第二周"></a>第二周</h1><h2 id="Gradient-Descent-for-Multiple-Variables"><a href="#Gradient-Descent-for-Multiple-Variables" class="headerlink" title="Gradient Descent for Multiple Variables"></a><strong>Gradient Descent for Multiple Variables</strong></h2><p>The gradient descent equation itself is generally the same form; we just have to repeat it for our ‘n’ features:</p>
<p><img src="https://wx2.sinaimg.cn/mw690/adba74c1ly1fz7a4vp952j20bf070weo.jpg" alt="image"></p>
<p>In other words:</p>
<p>}repeat until convergence:{<em>θ**j</em>:=<em>θ**j</em>−<em>α</em>1<em>m</em>∑<em>i</em>=1<em>m</em>(<em>h**θ</em>(<em>x</em>(<em>i</em>))−<em>y</em>(<em>i</em>))⋅<em>x</em>(<em>i</em>)<em>j</em>for j := 0…n</p>
<p>The following image compares gradient descent with one variable to gradient descent with multiple variables:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/MYm8uqafEeaZoQ7hPZtKqg_c974c2e2953662e9578b38c7b04591ed_Screenshot-2016-11-09-09.07.04.png?expiry=1547683200000&amp;hmac=AHaRnVtf0hh0yN91HhICEkapB6PUZwKjTz6V8RGraOU" alt="img"></p>
<h2 id="Gradient-Descent-in-Practice-I-Feature-Scaling"><a href="#Gradient-Descent-in-Practice-I-Feature-Scaling" class="headerlink" title="Gradient Descent in Practice I - Feature Scaling"></a>Gradient Descent in Practice I - Feature Scaling</h2><p>We can speed up gradient descent by having each of our input values in roughly the same range. This is because θ will descend quickly on small ranges and slowly on large ranges, and so will oscillate inefficiently down to the optimum when the variables are very uneven.</p>
<p>The way to prevent this is to modify the ranges of our input variables so that they are all roughly the same. Ideally:</p>
<p>$−1 ≤ x_{(i)} ≤ 1​$</p>
<p>or</p>
<p>$−0.5 ≤ x_{(i)} ≤ 0.5​$</p>
<p>These aren’t exact requirements; we are only trying to speed things up. The goal is to get all input variables into roughly one of these ranges, give or take a few.</p>
<p>Two techniques to help with this are <strong>feature scaling</strong> and <strong>mean normalization</strong>. Feature scaling involves dividing the input values by the range (i.e. the maximum value minus the minimum value) of the input variable, resulting in a new range of just 1. Mean normalization involves subtracting the average value for an input variable from the values for that input variable resulting in a new average value for the input variable of just zero. To implement both of these techniques, adjust your input values as shown in this formula:</p>
<p>$x_i := \dfrac{x_i - \mu_i}{s_i}​$</p>
<p>Where $μ_i$ is the <strong>average</strong> of all the values for feature (i) and $s_i$is the range of values (max - min), or $s_i$is the standard deviation.</p>
<p>Note that dividing by the range, or dividing by the standard deviation, give different results. The quizzes in this course use range - the programming exercises use standard deviation.</p>
<p>For example, if $x_i$ represents housing prices with a range of 100 to 2000 and a mean value of 1000, then, $x_i := \dfrac{price-1000}{1900}$.</p>
<h2 id="Gradient-Descent-in-Practice-II-Learning-Rate"><a href="#Gradient-Descent-in-Practice-II-Learning-Rate" class="headerlink" title="Gradient Descent in Practice II - Learning Rate"></a>Gradient Descent in Practice II - Learning Rate</h2><p><strong>Debugging gradient descent.</strong> Make a plot with <em>number of iterations</em> on the x-axis. Now plot the cost function, J(θ) over the number of iterations of gradient descent. If J(θ) ever increases, then you probably need to decrease α.</p>
<p><strong>Automatic convergence test.</strong> Declare convergence if J(θ) decreases by less than E in one iteration, where E is some small value such as 10−3. However in practice it’s difficult to choose this threshold value.</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/FEfS3aajEea3qApInhZCFg_6be025f7ad145eb0974b244a7f5b3f59_Screenshot-2016-11-09-09.35.59.png?expiry=1547683200000&amp;hmac=AnsPwSwNmRVY34rI4n99inP3eWG5P_gv1OWCAmLXMt0" alt="img"></p>
<p>It has been proven that if learning rate α is sufficiently small, then J(θ) will decrease on every iteration.</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/rC2jGKgvEeamBAoLccicqA_ec9e40a58588382f5b6df60637b69470_Screenshot-2016-11-11-08.55.21.png?expiry=1547683200000&amp;hmac=TWHJNdipwsfYy15H2FNpeXSMZardNpmHd0tvk0BRiVQ" alt="img"></p>
<p>To summarize:</p>
<p>If $\alpha$ is too small: slow convergence.</p>
<p>If $\alpha$ is too large: ￼may not decrease on every iteration and thus may not converge.</p>
<h2 id="Polynomial-Regression"><a href="#Polynomial-Regression" class="headerlink" title="Polynomial Regression"></a><strong>Polynomial Regression</strong></h2><p>Our hypothesis function need not be linear (a straight line) if that does not fit the data well.</p>
<p>We can <strong>change the behavior or curve</strong> of our hypothesis function by making it a quadratic, cubic or square root function (or any other form).</p>
<p>For example, if our hypothesis function is $h_\theta(x) = \theta_0 + \theta_1 x_1$ then we can create additional features based on $x_1$, to get the quadratic function$ h_\theta(x) = \theta_0 + \theta_1 x_1 + \theta_2 x_1^2 $or the cubic function $h_\theta(x) = \theta_0 + \theta_1 x_1 + \theta_2 x_1^2 + \theta_3 x_1^3​$</p>
<p>In the cubic version, we have created new features $x_2$ and $x_3$ where $x_2 = x_1^2$ and $x_3 = x_1^3$.</p>
<p>To make it a square root function, we could do: $h_\theta(x) = \theta_0 + \theta_1 x_1 + \theta_2 \sqrt{x_1}​$</p>
<p>One important thing to keep in mind is, if you choose your features this way then feature scaling becomes very important.</p>
<p>eg. if $x_1$ has range 1 - 1000 then range of $x_1^2$ becomes 1 - 1000000 and that of $x_1^3$ becomes 1 - 1000000000</p>
<h2 id="Normal-Equation"><a href="#Normal-Equation" class="headerlink" title="Normal Equation"></a>Normal Equation</h2><p>Gradient descent gives one way of minimizing J. Let’s discuss a second way of doing so, this time performing the minimization explicitly and without resorting to an iterative algorithm. In the “Normal Equation” method, we will minimize J by explicitly taking its derivatives with respect to the θj ’s, and setting them to zero. This allows us to find the optimum theta without iteration. The normal equation formula is given below:</p>
<p>$\theta = (X^T X)^{-1}X^T y$</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/dykma6dwEea3qApInhZCFg_333df5f11086fee19c4fb81bc34d5125_Screenshot-2016-11-10-10.06.16.png?expiry=1547683200000&amp;hmac=Mk3Cfi9-YlJiAIPUsSxAuIN0xo01-aD92hi5VqjrO5c" alt="img"></p>
<p>There is <strong>no need</strong> to do feature scaling with the normal equation.</p>
<p>The following is a comparison of gradient descent and the normal equation:</p>
<table>
<thead>
<tr>
<th>Gradient Descent</th>
<th>Normal Equation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Need to choose alpha</td>
<td>No need to choose alpha</td>
</tr>
<tr>
<td>Needs many iterations</td>
<td>No need to iterate</td>
</tr>
<tr>
<td>O (k$n^2$)</td>
<td>O ($n^3$), need to calculate inverse of $X^TX$</td>
</tr>
<tr>
<td>Works well when n is large</td>
<td>Slow if n is very large</td>
</tr>
</tbody>
</table>
<p>With the normal equation, computing the inversion has complexity $\mathcal{O}(n^3)$. So if we have a very large number of features, the normal equation will be slow. In practice, when n exceeds 10,000 it might be a good time to go from a normal solution to an iterative process.</p>
<h2 id="Normal-Equation-Noninvertibility"><a href="#Normal-Equation-Noninvertibility" class="headerlink" title="Normal Equation Noninvertibility"></a>Normal Equation Noninvertibility</h2><p>When implementing the normal equation in octave we want to use the ‘pinv’ function rather than ‘inv.’ The ‘pinv’ function will give you a value of $\theta$ even if $X^TX$ is not invertible.</p>
<p>If $X^TX$ is <strong>noninvertible,</strong> the common causes might be having :</p>
<ul>
<li>Redundant features, where two features are very closely related (i.e. they are linearly dependent)</li>
<li>Too many features (e.g. m ≤ n). In this case, delete some features or use “regularization” (to be explained in a later lesson).</li>
</ul>
<p>Solutions to the above problems include deleting a feature that is linearly dependent with another or deleting one or more features when there are too many features.</p>
<h1 id="第三周"><a href="#第三周" class="headerlink" title="第三周"></a>第三周</h1><h2 id="Classification"><a href="#Classification" class="headerlink" title="Classification"></a>Classification</h2><p>To attempt classification, one method is to use linear regression and map all predictions greater than 0.5 as a 1 and all less than 0.5 as a 0. However, this method doesn’t work well because classification is not actually a linear function.</p>
<p>The classification problem is just like the regression problem, except that the values we now want to predict take on only a small number of discrete values. For now, we will focus on the <strong>binary classification</strong> <strong>problem</strong> in which y can take on only two values, 0 and 1. (Most of what we say here will also generalize to the multiple-class case.) For instance, if we are trying to build a spam classifier for email, then $x^{(i)}$ may be some features of a piece of email, and y may be 1 if it is a piece of spam mail, and 0 otherwise. Hence, y∈{0,1}. 0 is also called the negative class, and 1 the positive class, and they are sometimes also denoted by the symbols “-” and “+.” Given $x^{(i)}$, the corresponding $y^{(i)}​$ is also called the label for the training example.</p>
<h2 id="Hypothesis-Representation"><a href="#Hypothesis-Representation" class="headerlink" title="Hypothesis Representation"></a>Hypothesis Representation</h2><p>We could approach the classification problem ignoring the fact that y is discrete-valued, and use our old linear regression algorithm to try to predict y given x. However, it is easy to construct examples where this method performs very poorly. Intuitively, it also doesn’t make sense for $h_\theta (x)​$  to take values larger than 1 or smaller than 0 when we know that y ∈ {0, 1}. To fix this, let’s change the form for our hypotheses  $h_\theta (x)​$  to satisfy $0 \leq h_\theta (x) \leq 1​$. This is accomplished by plugging $\theta^Tx​$ into the Logistic Function.</p>
<p>Our new form uses the “Sigmoid Function,” also called the “Logistic Function”:</p>
<p><em>h**θ</em>(<em>x</em>)=<em>g</em>(<em>θ<strong>T</strong>x</em>)<em>z</em>=<em>θ<strong>T</strong>x**g</em>(<em>z</em>)=11+<em>e</em>−<em>z</em></p>
<p>$z=\theta^Tx$</p>
<p>g(z)=1/(1+e^(-z))​</p>
<p>The following image shows us what the sigmoid function looks like:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/1WFqZHntEead-BJkoDOYOw_2413fbec8ff9fa1f19aaf78265b8a33b_Logistic_function.png?expiry=1547769600000&amp;hmac=SGvwWcXcPDVMPhLj-k_pIb7hC2V7VWwDhh8Xsx5xQls" alt="img"></p>
<p>The function g(z), shown here, maps any real number to the (0, 1) interval, making it useful for transforming an arbitrary-valued function into a function better suited for classification.</p>
<p>$h_\theta(x)​$ will give us the <strong>probability</strong> that our output is 1. For example, $h_\theta(x)=0.7​$  gives us a probability of 70% that our output is 1. Our probability that our prediction is 0 is just the complement of our probability that it is 1 (e.g. if probability that it is 1 is 70%, then the probability that it is 0 is 30%).</p>
<p><em>h**θ</em>(<em>x</em>)=<em>P</em>(<em>y</em>=1|<em>x</em>;<em>θ</em>)=1−<em>P</em>(<em>y</em>=0|<em>x</em>;<em>θ</em>)<em>P</em>(<em>y</em>=0|<em>x</em>;<em>θ</em>)+<em>P</em>(<em>y</em>=1|<em>x</em>;<em>θ</em>)=1</p>
<h2 id="Cost-Function"><a href="#Cost-Function" class="headerlink" title="Cost Function"></a>Cost Function</h2><p>We cannot use the same cost function that we use for linear regression because the Logistic Function will cause the output to be wavy, causing many local optima. In other words, it will not be a convex function.</p>
<p>Instead, our cost function for logistic regression looks like:</p>
<p><em>J</em>(<em>θ</em>)=1<em>m</em>∑<em>i</em>=1<em>m</em>Cost(<em>h**θ</em>(<em>x</em>(<em>i</em>)),<em>y</em>(<em>i</em>))Cost(<em>h**θ</em>(<em>x</em>),<em>y</em>)=−log(<em>h**θ</em>(<em>x</em>))Cost(<em>h**θ</em>(<em>x</em>),<em>y</em>)=−log(1−<em>h**θ</em>(<em>x</em>))if y = 1if y = 0</p>
<p>When y = 1, we get the following plot for $J(\theta) vs h_\theta (x)​$:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/Q9sX8nnxEeamDApmnD43Fw_1cb67ecfac77b134606532f5caf98ee4_Logistic_regression_cost_function_positive_class.png?expiry=1547769600000&amp;hmac=slTMVn1jZLWrLgnCy-KuNgshbF-dVWxl5PAy9fJWVgk" alt="img"></p>
<p>Similarly, when y = 0, we get the following plot for$ J(\theta) vs h_\theta (x)$ :</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/Ut7vvXnxEead-BJkoDOYOw_f719f2858d78dd66d80c5ec0d8e6b3fa_Logistic_regression_cost_function_negative_class.png?expiry=1547769600000&amp;hmac=80HXBGDsKhe9IZVLk58D_udFVnvj0p1shbvBY2RPhA0" alt="img"></p>
<p>Cost(<em>h**θ</em>(<em>x</em>),<em>y</em>)=0 if <em>h**θ</em>(<em>x</em>)=<em>y</em>Cost(<em>h**θ</em>(<em>x</em>),<em>y</em>)→∞ if <em>y</em>=0and<em>h**θ</em>(<em>x</em>)→1Cost(<em>h**θ</em>(<em>x</em>),<em>y</em>)→∞ if <em>y</em>=1and<em>h**θ</em>(<em>x</em>)→0</p>
<p>If our correct answer ‘y’ is 0, then the cost function will be 0 if our hypothesis function also outputs 0. If our hypothesis approaches 1, then the cost function will approach infinity.</p>
<p>If our correct answer ‘y’ is 1, then the cost function will be 0 if our hypothesis function outputs 1. If our hypothesis approaches 0, then the cost function will approach infinity.</p>
<p>Note that writing the cost function in this way guarantees that J(θ) is convex for logistic regression.</p>
<h2 id="Simplified-Cost-Function-and-Gradient-Descent"><a href="#Simplified-Cost-Function-and-Gradient-Descent" class="headerlink" title="Simplified Cost Function and Gradient Descent"></a>Simplified Cost Function and Gradient Descent</h2><p>We can compress our cost function’s two conditional cases into one case:</p>
<p>$\mathrm{Cost}(h_\theta(x),y) = - y \; \log(h_\theta(x)) - (1 - y) \log(1 - h_\theta(x))$</p>
<p>Notice that when y is equal to 1, then the second term$ (1-y)\log(1-h_\theta(x))$ will be zero and will not affect the result. If y is equal to 0, then the first term $-y \log(h_\theta(x))$ will be zero and will not affect the result.</p>
<p>We can fully write out our entire cost function as follows:</p>
<p>J(\theta) = - \frac{1}{m} \displaystyle \sum_{i=1}^m [y^{(i)}\log (h_\theta (x^{(i)})) + (1 - y^{(i)})\log (1 - h_\theta(x^{(i)}))]<em>J</em>(<em>θ</em>)=−<em>m</em>1<em>i</em>=1∑<em>m</em>[<em>y</em>(<em>i</em>)log(<em>h**θ</em>(<em>x</em>(<em>i</em>)))+(1−<em>y</em>(<em>i</em>))log(1−<em>h**θ</em>(<em>x</em>(<em>i</em>)))]</p>
<p>A vectorized implementation is:</p>
<p>$h=g(Xθ)​$</p>
<p>$J(θ)=1/m⋅(-y^Tlog(h)-(1-y)^Tlog(1-h))​$</p>
<h3 id="Gradient-Descent-1"><a href="#Gradient-Descent-1" class="headerlink" title="Gradient Descent"></a><strong>Gradient Descent</strong></h3><p><img src="http://wx2.sinaimg.cn/mw690/adba74c1ly1fz8hro00ctj20np0dst9b.jpg" alt="image"></p>
<h2 id="Advanced-Optimization"><a href="#Advanced-Optimization" class="headerlink" title="Advanced Optimization"></a>Advanced Optimization</h2><p>“Conjugate gradient”, “BFGS”, and “L-BFGS” are more sophisticated, faster ways to optimize θ that can be used instead of gradient descent. We suggest that you should not write these more sophisticated algorithms yourself (unless you are an expert in numerical computing) but use the libraries instead, as they’re already tested and highly optimized. Octave provides them.</p>
<p>We first need to provide a function that evaluates the following two functions for a given input value θ:</p>
<p>J(θ)</p>
<p>∂/∂θj J(θ)</p>
<p>We can write a single function that returns both of these:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function [jVal, gradient] = costFunction(theta)</span><br><span class="line"></span><br><span class="line">  jVal = [...code to compute J(theta)...];</span><br><span class="line"></span><br><span class="line">  gradient = [...code to compute derivative of J(theta)...];</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>Then we can use octave’s “fminunc()” optimization algorithm along with the “optimset()” function that creates an object containing the options we want to send to “fminunc()”. (Note: the value for MaxIter should be an integer, not a character string - errata in the video at 7:30)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">options = optimset(&apos;GradObj&apos;, &apos;on&apos;, &apos;MaxIter&apos;, 100);</span><br><span class="line"></span><br><span class="line">initialTheta = zeros(2,1);</span><br><span class="line"></span><br><span class="line">   [optTheta, functionVal, exitFlag] = fminunc(@costFunction, initialTheta, </span><br><span class="line">     options);</span><br></pre></td></tr></table></figure>
<p>We give to the function “<strong>fminunc()</strong>“ our cost function, our initial vector of theta values, and the “options” object that we created beforehand.</p>
<h2 id="Multiclass-Classification-One-vs-all"><a href="#Multiclass-Classification-One-vs-all" class="headerlink" title="Multiclass Classification: One-vs-all"></a>Multiclass Classification: One-vs-all</h2><p>Now we will approach the classification of data when we have more than two categories. Instead of y = {0,1} we will expand our definition so that y = {0,1…n}.</p>
<p>Since y = {0,1…n}, we divide our problem into n+1 (+1 because the index starts at 0) binary classification problems; in each one, we predict the probability that ‘y’ is a member of one of our classes.</p>
<p><em>y</em>∈{0,1…<em>n</em>}<em>h</em>(0)<em>θ</em>(<em>x</em>)=<em>P</em>(<em>y</em>=0|<em>x</em>;<em>θ</em>)<em>h</em>(1)<em>θ</em>(<em>x</em>)=<em>P</em>(<em>y</em>=1|<em>x</em>;<em>θ</em>)⋯<em>h</em>(<em>n</em>)<em>θ</em>(<em>x</em>)=<em>P</em>(<em>y</em>=<em>n</em>|<em>x</em>;<em>θ</em>)prediction=max<em>i</em>(<em>h</em>(<em>i</em>)<em>θ</em>(<em>x</em>))</p>
<p>We are basically choosing one class and then lumping all the others into a single second class. We do this repeatedly, applying binary logistic regression to each case, and then use the hypothesis that returned the highest value as our prediction.</p>
<p>The following image shows how one could classify 3 classes:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/cqmPjanSEeawbAp5ByfpEg_299fcfbd527b6b5a7440825628339c54_Screenshot-2016-11-13-10.52.29.png?expiry=1547769600000&amp;hmac=FShI1rEquBknKBcbhioau5eg8Cw-GLknpl9rvay9ukY" alt="img"></p>
<p><strong>To summarize:</strong></p>
<p>Train a logistic regression classifier $h_\theta(x)​$ for each class￼ to predict the probability that ￼ ￼y = i￼ ￼.</p>
<p>To make a prediction on a new x, pick the class ￼that maximizes $h_\theta (x)$</p>
<h2 id="The-Problem-of-Overfitting"><a href="#The-Problem-of-Overfitting" class="headerlink" title="The Problem of Overfitting"></a>The Problem of Overfitting</h2><p>Consider the problem of predicting y from x ∈ R. The leftmost figure below shows the result of fitting a $y = θ_0 + θ_1x$  to a dataset. We see that the data doesn’t really lie on straight line, and so the fit is not very good.</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/0cOOdKsMEeaCrQqTpeD5ng_2a806eb8d988461f716f4799915ab779_Screenshot-2016-11-15-00.23.30.png?expiry=1547769600000&amp;hmac=TAsGHEDO_6W-LtIWJLsg-lorrVC-KhN5tIdgocmuXHY" alt="img"></p>
<p>Instead, if we had added an extra feature $x^2$ , and fit $y =  \theta_0 + \theta_1x + \theta_2x^2$  , then we obtain a slightly better fit to the data (See middle figure). Naively, it might seem that the more features we add, the better. However, there is also a danger in adding too many features: The rightmost figure is the result of fitting a $5^{th}$  order polynomial $y = \sum_{j=0} ^5 \theta_j x^j$ . We see that even though the fitted curve passes through the data perfectly, we would not expect this to be a very good predictor of, say, housing prices (y) for different living areas (x). Without formally defining what these terms mean, we’ll say the figure on the left shows an instance of <strong>underfitting</strong>—in which the data clearly shows structure not captured by the model—and the figure on the right is an example of <strong>overfitting</strong>.</p>
<p>Underfitting, or high bias, is when the form of our hypothesis function h maps poorly to the trend of the data. It is usually caused by a function that is too simple or uses too few features. At the other extreme, overfitting, or high variance, is caused by a hypothesis function that fits the available data but does not generalize well to predict new data. It is usually caused by a complicated function that creates a lot of unnecessary curves and angles unrelated to the data.</p>
<p>This terminology is applied to both linear and logistic regression. There are two main options to address the issue of overfitting:</p>
<p>1) Reduce the number of features:</p>
<ul>
<li>Manually select which features to keep.</li>
<li>Use a model selection algorithm (studied later in the course).</li>
</ul>
<p>2) Regularization</p>
<ul>
<li>Keep all the features, but reduce the magnitude of parameters $\theta_j$ .</li>
<li>Regularization works well when we have a lot of slightly useful features.</li>
</ul>
<h2 id="Cost-Function-1"><a href="#Cost-Function-1" class="headerlink" title="Cost Function"></a>Cost Function</h2><p>If we have overfitting from our hypothesis function, we can reduce the weight that some of the terms in our function carry by increasing their cost.</p>
<p>Say we wanted to make the following function more quadratic:</p>
<p>$\theta_0 + \theta_1x + \theta_2x^2 + \theta_3x^3 + \theta_4x^4$</p>
<p>We’ll want to eliminate the influence of $\theta_3x^3$ and $\theta_4x^4$ . Without actually getting rid of these features or changing the form of our hypothesis, we can instead modify our <strong>cost function</strong>:</p>
<p>$min_\theta\ \dfrac{1}{2m}\sum_{i=1}^m (h_\theta(x^{(i)}) - y^{(i)})^2 + 1000\cdot\theta_3^2 + 1000\cdot\theta_4^2$</p>
<p>We’ve added two extra terms at the end to inflate the cost of $\theta_3$  and $\theta_4$ . Now, in order for the cost function to get close to zero, we will have to reduce the values of $\theta_3$ and $\theta_4$ to near zero. This will in turn greatly reduce the values of $\theta_3x^3$ and $\theta_4x^4$  in our hypothesis function. As a result, we see that the new hypothesis (depicted by the pink curve) looks like a quadratic function but fits the data better due to the extra small terms $\theta_3x^3$ and $\theta_4x^4$.</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/j0X9h6tUEeawbAp5ByfpEg_ea3e85af4056c56fa704547770da65a6_Screenshot-2016-11-15-08.53.32.png?expiry=1547769600000&amp;hmac=rMlX6qjNbtqerouP_Go-rJ5PDaHFW2xSdE9X4_kUosM" alt="img"></p>
<p>We could also regularize all of our theta parameters in a single summation as:</p>
<p>min_\theta\ \dfrac{1}{2m}\ \sum_{i=1}^m (h_\theta(x^{(i)}) - y^{(i)})^2 + \lambda\ \sum_{j=1}^n \theta_j^2<em>m<strong>i</strong>n**θ</em> 2<em>m</em>1 ∑<em>i</em>=1<em>m</em>(<em>h**θ</em>(<em>x</em>(<em>i</em>))−<em>y</em>(<em>i</em>))2+<em>λ</em> ∑<em>j</em>=1<em>n<strong>θ</strong>j</em>2</p>
<p>The λ, or lambda, is the <strong>regularization parameter</strong>. It determines how much the costs of our theta parameters are inflated.</p>
<p>Using the above cost function with the extra summation, we can smooth the output of our hypothesis function to reduce overfitting. If lambda is chosen to be too large, it may smooth out the function too much and cause underfitting. Hence, what would happen if $\lambda = 0​$ or is too small ?</p>
<h2 id="Regularized-Linear-Regression"><a href="#Regularized-Linear-Regression" class="headerlink" title="Regularized Linear Regression"></a>Regularized Linear Regression</h2><p><strong>Note:</strong> [8:43 - It is said that X is non-invertible if m \leq≤ n. The correct statement should be that X is non-invertible if m &lt; n, and may be non-invertible if m = n.</p>
<p>We can apply regularization to both linear regression and logistic regression. We will approach linear regression first.</p>
<h3 id="Gradient-Descent-2"><a href="#Gradient-Descent-2" class="headerlink" title="Gradient Descent"></a>Gradient Descent</h3><p>We will modify our gradient descent function to separate out \theta_0<em>θ</em>0 from the rest of the parameters because we do not want to penalize \theta_0<em>θ</em>0.</p>
<p>Repeat {    <em>θ</em>0:=<em>θ</em>0−<em>α</em> 1<em>m</em> ∑<em>i</em>=1<em>m</em>(<em>h**θ</em>(<em>x</em>(<em>i</em>))−<em>y</em>(<em>i</em>))<em>x</em>(<em>i</em>)0    <em>θ**j</em>:=<em>θ**j</em>−<em>α</em> [(1<em>m</em> ∑<em>i</em>=1<em>m</em>(<em>h**θ</em>(<em>x</em>(<em>i</em>))−<em>y</em>(<em>i</em>))<em>x</em>(<em>i</em>)<em>j</em>)+<em>λ<strong>m</strong>θ**j</em>]}          <em>j</em>∈{1,2…<em>n</em>}</p>
<p>The term $\frac{\lambda}{m}\theta_j$performs our regularization. With some manipulation our update rule can also be represented as:</p>
<p>$\theta_j := \theta_j(1 - \alpha\frac{\lambda}{m}) - \alpha\frac{1}{m}\sum_{i=1}^m(h_\theta(x^{(i)}) - y^{(i)})x_j^{(i)}$</p>
<p>The first term in the above equation, $1 - \alpha\frac{\lambda}{m}$ will always be less than 1. Intuitively you can see it as reducing the value of $\theta_j$  by some amount on every update. Notice that the second term is now exactly the same as it was before.</p>
<h3 id="Normal-Equation-1"><a href="#Normal-Equation-1" class="headerlink" title="Normal Equation"></a><strong>Normal Equation</strong></h3><p>Now let’s approach regularization using the alternate method of the non-iterative normal equation.</p>
<p>To add in regularization, the equation is the same as our original, except that we add another term inside the parentheses:</p>
<p><em>θ</em>=(<em>X<strong>T</strong>X</em>+<em>λ</em>⋅<em>L</em>)−1<em>X<strong>T</strong>y</em>where  <em>L</em>=⎡⎣⎢⎢⎢⎢⎢⎢011⋱1⎤⎦⎥⎥⎥⎥⎥⎥</p>
<p>L is a matrix with 0 at the top left and 1’s down the diagonal, with 0’s everywhere else. It should have dimension (n+1)×(n+1). Intuitively, this is the identity matrix (though we are not including $x_0$ ), multiplied with a single real number λ.</p>
<p>Recall that if m &lt; n, then $X^TX$ is non-invertible. However, when we add the term λ⋅L, then $X^TX $+ λ⋅L becomes invertible.</p>
<h2 id="Regularized-Logistic-Regression"><a href="#Regularized-Logistic-Regression" class="headerlink" title="Regularized Logistic Regression"></a>Regularized Logistic Regression</h2><p>We can regularize logistic regression in a similar way that we regularize linear regression. As a result, we can avoid overfitting. The following image shows how the regularized function, displayed by the pink line, is less likely to overfit than the non-regularized function represented by the blue line:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/Od9mobDaEeaCrQqTpeD5ng_4f5e9c71d1aa285c1152ed4262f019c1_Screenshot-2016-11-22-09.31.21.png?expiry=1547769600000&amp;hmac=A7T4qSaj6xflwdiqpZVcD-Sp5FKPUIOLGd0idlepBhY" alt="img"></p>
<h3 id="Cost-Function-2"><a href="#Cost-Function-2" class="headerlink" title="Cost Function"></a>Cost Function</h3><p>Recall that our cost function for logistic regression was:</p>
<p>$J(\theta) = - \frac{1}{m} \sum_{i=1}^m \large[ y^{(i)}\ \log (h_\theta (x^{(i)})) + (1 - y^{(i)})\ \log (1 - h_\theta(x^{(i)})) \large]$ </p>
<p>We can regularize this equation by adding a term to the end:</p>
<p>J(\theta) = - \frac{1}{m} \sum_{i=1}^m \large[ y^{(i)}\ \log (h_\theta (x^{(i)})) + (1 - y^{(i)})\ \log (1 - h_\theta(x^{(i)}))\large] + \frac{\lambda}{2m}\sum_{j=1}^n \theta_j^2<em>J</em>(<em>θ</em>)=−<em>m</em>1∑<em>i</em>=1<em>m</em>[<em>y</em>(<em>i</em>) log(<em>h**θ</em>(<em>x</em>(<em>i</em>)))+(1−<em>y</em>(<em>i</em>)) log(1−<em>h**θ</em>(<em>x</em>(<em>i</em>)))]+2<em>m**λ</em>∑<em>j</em>=1<em>n<strong>θ</strong>j</em>2</p>
<p>The second sum, $\sum_{j=1}^n \theta_j^2$ <strong>means to explicitly exclude</strong> the bias term, $\theta_0$ . I.e. the θ vector is indexed from 0 to n (holding n+1 values, $\theta_0$  through $\theta_n$ ), and this sum explicitly skips $\theta_0$ , by running from 1 to n, skipping 0. Thus, when computing the equation, we should continuously update the two following equations:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/dfHLC70SEea4MxKdJPaTxA_306de28804a7467f7d84da0fe3ee9c7b_Screen-Shot-2016-12-07-at-10.49.02-PM.png?expiry=1547769600000&amp;hmac=XZIJfjIAgXVWp_ZG0NiHWdYid1telhe2WfwAMscAo8E" alt="img"></p>
<h1 id="第四周"><a href="#第四周" class="headerlink" title="第四周"></a>第四周</h1><h2 id="Model-Representation-II"><a href="#Model-Representation-II" class="headerlink" title="Model Representation II"></a>Model Representation II</h2><p>To re-iterate, the following is an example of a neural network:</p>
<p><em>a</em>(2)1=<em>g</em>(Θ(1)10<em>x</em>0+Θ(1)11<em>x</em>1+Θ(1)12<em>x</em>2+Θ(1)13<em>x</em>3)<em>a</em>(2)2=<em>g</em>(Θ(1)20<em>x</em>0+Θ(1)21<em>x</em>1+Θ(1)22<em>x</em>2+Θ(1)23<em>x</em>3)<em>a</em>(2)3=<em>g</em>(Θ(1)30<em>x</em>0+Θ(1)31<em>x</em>1+Θ(1)32<em>x</em>2+Θ(1)33<em>x</em>3)<em>h</em>Θ(<em>x</em>)=<em>a</em>(3)1=<em>g</em>(Θ(2)10<em>a</em>(2)0+Θ(2)11<em>a</em>(2)1+Θ(2)12<em>a</em>(2)2+Θ(2)13<em>a</em>(2)3)</p>
<p>In this section we’ll do a vectorized implementation of the above functions. We’re going to define a new variable $z_k^{(j)}$ that encompasses the parameters inside our g function. In our previous example if we replaced by the variable z for all the parameters we would get:</p>
<p><em>a</em>(2)1=<em>g</em>(<em>z</em>(2)1)<em>a</em>(2)2=<em>g</em>(<em>z</em>(2)2)<em>a</em>(2)3=<em>g</em>(<em>z</em>(2)3)</p>
<p>In other words, for layer j=2 and node k, the variable z will be:</p>
<p>z_k^{(2)} = \Theta_{k,0}^{(1)}x_0 + \Theta_{k,1}^{(1)}x_1 + \cdots + \Theta_{k,n}^{(1)}x_n<em>z**k</em>(2)=Θ<em>k</em>,0(1)<em>x</em>0+Θ<em>k</em>,1(1)<em>x</em>1+⋯+Θ<em>k</em>,<em>n</em>(1)<em>x**n</em></p>
<p>The vector representation of x and $z^{j}$ is:</p>
<p><em>x</em>=⎡⎣⎢⎢<em>x</em>0<em>x</em>1⋯<em>x**n</em>⎤⎦⎥⎥<em>z</em>(<em>j</em>)=⎡⎣⎢⎢⎢⎢<em>z</em>(<em>j</em>)1<em>z</em>(<em>j</em>)2⋯<em>z</em>(<em>j</em>)<em>n</em>⎤⎦⎥⎥⎥⎥</p>
<p>Setting $x = a^{(1)}$,  we can rewrite the equation as:</p>
<p>z^{(j)} = \Theta^{(j-1)}a^{(j-1)}<em>z</em>(<em>j</em>)=Θ(<em>j</em>−1)<em>a</em>(<em>j</em>−1)</p>
<p>We are multiplying our matrix $\Theta^{(j-1)}​$  with dimensions $s_j\times (n+1)​$ (where $s_j​$  is the number of our activation nodes) by our vector $a^{(j-1)}​$  with height (n+1). This gives us our vector $z^{(j)}​$  with height $s_j​$ . Now we can get a vector of our activation nodes for layer j as follows:</p>
<p>$a^{(j)} = g(z^{(j)})​$ </p>
<p>Where our function g can be applied element-wise to our vector $z^{(j)}$.</p>
<p>We can then add a bias unit (equal to 1) to layer j after we have computed $a^{(j)}$. This will be element $a_0^{(j)}$ and will be equal to 1. To compute our final hypothesis, let’s first compute another z vector:</p>
<p>$z^{(j+1)} = \Theta^{(j)}a^{(j)}​$ </p>
<p>We get this final z vector by multiplying the next theta matrix after $\Theta^{(j-1)}​$  with the values of all the activation nodes we just got. This last theta matrix $\Theta^{(j)}​$ will have only <strong>one row</strong> which is multiplied by one column $a^{(j)}​$ so that our result is a single number. We then get our final result with:</p>
<p>$h_\Theta(x) = a^{(j+1)} = g(z^{(j+1)})​$</p>
<p>Notice that in this <strong>last step</strong>, between layer j and layer j+1, we are doing <strong>exactly the same thing</strong> as we did in logistic regression. Adding all these intermediate layers in neural networks allows us to more elegantly produce interesting and more complex non-linear hypotheses.</p>
<h2 id="Examples-and-Intuitions"><a href="#Examples-and-Intuitions" class="headerlink" title="Examples and Intuitions"></a>Examples and Intuitions</h2><p>A simple example of applying neural networks is by predicting $x_1$ AND $x_2$, which is the logical ‘and’ operator and is only true if both $x_1$  and $x_2$ are 1.</p>
<p>The graph of our functions will look like:</p>
<p>⎡⎣<em>x</em>0<em>x</em>1<em>x</em>2⎤⎦→[<em>g</em>(<em>z</em>(2))]→<em>h</em>Θ(<em>x</em>)</p>
<p>Remember that $x_0​$  is our bias variable and is always 1.</p>
<p>Let’s set our first theta matrix as:</p>
<p>\Theta^{(1)} =[−302020]Θ(1)=[−302020]</p>
<p>This will cause the output of our hypothesis to only be positive if both $x_1​$ and $x_2$ are 1. In other words:</p>
<p><em>h</em>Θ(<em>x</em>)=<em>g</em>(−30+20<em>x</em>1+20<em>x</em>2)<em>x</em>1=0  <em>a<strong>n</strong>d</em>  <em>x</em>2=0  <em>t<strong>h</strong>e**n</em>  <em>g</em>(−30)≈0<em>x</em>1=0  <em>a<strong>n</strong>d</em>  <em>x</em>2=1  <em>t<strong>h</strong>e**n</em>  <em>g</em>(−10)≈0<em>x</em>1=1  <em>a<strong>n</strong>d</em>  <em>x</em>2=0  <em>t<strong>h</strong>e**n</em>  <em>g</em>(−10)≈0<em>x</em>1=1  <em>a<strong>n</strong>d</em>  <em>x</em>2=1  <em>t<strong>h</strong>e**n</em>  <em>g</em>(10)≈1</p>
<p>So we have constructed one of the fundamental operations in computers by using a small neural network rather than using an actual AND gate. Neural networks can also be used to simulate all the other logical gates. The following is an example of the logical operator ‘OR’, meaning either x_1<em>x</em>1 is true or x_2<em>x</em>2 is true, or both:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/f_ueJLGnEea3qApInhZCFg_a5ff8edc62c9a09900eae075e8502e34_Screenshot-2016-11-23-10.03.48.png?expiry=1547942400000&amp;hmac=JkvOTr36LgHTc1HhLNYMWnLTK--zvIgdb41C2h9oiKo" alt="img"></p>
<p>Where g(z) is the following:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/wMOiMrGnEeajLxLfjQiSjg_bbbdad80f5c95068bde7c9134babdd77_Screenshot-2016-11-23-10.07.24.png?expiry=1547942400000&amp;hmac=rXQZWvXvOO7yN9J6hqbRn5d8VHvnTqPUB5EPQOpZnOM" alt="img"></p>
<p>And there we have the XNOR operator using a hidden layer with two nodes! The following summarizes the above algorithm:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/rag_zbGqEeaSmhJaoV5QvA_52c04a987dcb692da8979a2198f3d8d7_Screenshot-2016-11-23-10.28.41.png?expiry=1547942400000&amp;hmac=0jWbW-vJ0f6D-9ZazKJ2YhCQTgv5MMyM5N2unLt4lIk" alt="img"></p>
<h2 id="Multiclass-Classification"><a href="#Multiclass-Classification" class="headerlink" title="Multiclass Classification"></a>Multiclass Classification</h2><p>To classify data into multiple classes, we let our hypothesis function return a vector of values. Say we wanted to classify our data into one of four categories. We will use the following example to see how this classification is done. This algorithm takes as input an image and classifies it accordingly:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/9Aeo6bGtEea4MxKdJPaTxA_4febc7ec9ac9dd0e4309bd1778171d36_Screenshot-2016-11-23-10.49.05.png?expiry=1547942400000&amp;hmac=WEhRJ5dd1GPfW5dU-XQBhDNkPQG6dHhmw8N1hKC-E-8" alt="img"></p>
<h2 id="Cost-Function-3"><a href="#Cost-Function-3" class="headerlink" title="Cost Function"></a>Cost Function</h2><p>Let’s first define a few variables that we will need to use:</p>
<ul>
<li>L = total number of layers in the network</li>
<li>$s_l$ = number of units (not counting bias unit) in layer l</li>
<li>K = number of output units/classes</li>
</ul>
<p>Recall that in neural networks, we may have many output nodes. We denote $h_\Theta(x)_k​$  as being a hypothesis that results in the $k^{th}​$ output. Our cost function for neural networks is going to be a generalization of the one we used for logistic regression. Recall that the cost function for regularized logistic regression was:</p>
<p>J(\theta) = - \frac{1}{m} \sum_{i=1}^m [ y^{(i)}\ \log (h_\theta (x^{(i)})) + (1 - y^{(i)})\ \log (1 - h_\theta(x^{(i)}))] + \frac{\lambda}{2m}\sum_{j=1}^n \theta_j^2<em>J</em>(<em>θ</em>)=−<em>m</em>1∑<em>i</em>=1<em>m</em>[<em>y</em>(<em>i</em>) log(<em>h**θ</em>(<em>x</em>(<em>i</em>)))+(1−<em>y</em>(<em>i</em>)) log(1−<em>h**θ</em>(<em>x</em>(<em>i</em>)))]+2<em>m**λ</em>∑<em>j</em>=1<em>n<strong>θ</strong>j</em>2</p>
<p>For neural networks, it is going to be slightly more complicated:</p>
<p><em>J</em>(Θ)=−1<em>m</em>∑<em>i</em>=1<em>m</em>∑<em>k</em>=1<em>K</em>[<em>y</em>(<em>i</em>)<em>k</em>log((<em>h</em>Θ(<em>x</em>(<em>i</em>)))<em>k</em>)+(1−<em>y</em>(<em>i</em>)<em>k</em>)log(1−(<em>h</em>Θ(<em>x</em>(<em>i</em>)))<em>k</em>)]+<em>λ</em>2<em>m</em>∑<em>l</em>=1<em>L</em>−1∑<em>i</em>=1<em>s**l</em>∑<em>j</em>=1<em>s**l</em>+1(Θ(<em>l</em>)<em>j</em>,<em>i</em>)2</p>
<p>We have added a few nested summations to account for our multiple output nodes. In the first part of the equation, before the square brackets, we have an additional nested summation that loops through the number of output nodes.</p>
<p>In the regularization part, after the square brackets, we must account for multiple theta matrices. The number of columns in our current theta matrix is equal to the number of nodes in our current layer (including the bias unit). The number of rows in our current theta matrix is equal to the number of nodes in the next layer (excluding the bias unit). As before with logistic regression, we square every term.</p>
<p>Note:</p>
<ul>
<li>the double sum simply adds up the logistic regression costs calculated for each cell in the output layer</li>
<li>the triple sum simply adds up the squares of all the individual Θs in the entire network.</li>
<li>the i in the triple sum does <strong>not</strong> refer to training example i</li>
</ul>
<h2 id="Backpropagation-Algorithm"><a href="#Backpropagation-Algorithm" class="headerlink" title="Backpropagation Algorithm"></a>Backpropagation Algorithm</h2><p>“Backpropagation” is neural-network terminology for minimizing our cost function, just like what we were doing with gradient descent in logistic and linear regression. Our goal is to compute:</p>
<p>$\min_\Theta J(\Theta)​$ </p>
<p>That is, we want to minimize our cost function J using an optimal set of parameters in theta. In this section we’ll look at the equations we use to compute the partial derivative of J(Θ):</p>
<p>$\dfrac{\partial}{\partial \Theta_{i,j}^{(l)}}J(\Theta)$ </p>
<p>To do so, we use the following algorithm:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/Ul6i5teoEea1UArqXEX_3g_a36fb24a11c744d7552f0fecf2fdd752_Screenshot-2017-01-10-17.13.27.png?expiry=1547942400000&amp;hmac=QZldoAbXaPD5iOXL7mGoms9SZhFPvU3RKhopNuz73q8" alt="img"></p>
<p><strong>Back propagation Algorithm</strong></p>
<p>Given training set $\lbrace (x^{(1)}, y^{(1)}) \cdots (x^{(m)}, y^{(m)})\rbrace$ </p>
<ul>
<li>Set $\Delta^{(l)}_{i,j}$  := 0 for all (l,i,j), (hence you end up having a matrix full of zeros)</li>
</ul>
<p>For training example t =1 to m:</p>
<ol>
<li>Set $ a^{(1)} := x^{(t)}$ </li>
<li>Perform forward propagation to compute $a^{(l)}$   for l=2,3,…,L</li>
</ol>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/bYLgwteoEeaX9Qr89uJd1A_73f280ff78695f84ae512f19acfa29a3_Screenshot-2017-01-10-18.16.50.png?expiry=1547942400000&amp;hmac=7S9m45Xx1rSF91ytZqrOtpP3IunjDCnxBqEPp_Ibi3E" alt="img"></p>
<ol start="3">
<li>Using $y^{(t)}$ , compute $\delta^{(L)} = a^{(L)} - y^{(t)}$</li>
</ol>
<p>Where L is our total number of layers and $a^{(L)}$ is the vector of outputs of the activation units for the last layer. So our “error values” for the last layer are simply the differences of our actual results in the last layer and the correct outputs in y. To get the delta values of the layers before the last layer, we can use an equation that steps us back from right to left:</p>
<ol start="4">
<li>Compute $\delta^{(L-1)}$, $\delta^{(L-2)},\dots,\delta^{(2)}$ using $\delta^{(l)} = ((\Theta^{(l)})^T \delta^{(l+1)})\ .<em>\ a^{(l)}\ .</em>\ (1 - a^{(l)}) $</li>
</ol>
<p>The delta values of layer l are calculated by multiplying the delta values in the next layer with the theta matrix of layer l. We then element-wise multiply that with a function called g’, or g-prime, which is the derivative of the activation function g evaluated with the input values given by z^{(l)}<em>z</em>(<em>l</em>).</p>
<p>The g-prime derivative terms can also be written out as:</p>
<p>g’(z^{(l)}) = a^{(l)}\ .<em>\ (1 - a^{(l)})</em>g<em>′(</em>z<em>(</em>l<em>))=</em>a<em>(</em>l<em>) .∗ (1−</em>a<em>(</em>l*))</p>
<ol start="5">
<li>$\Delta^{(l)}<em>{i,j} := \Delta^{(l)}</em>{i,j} + a_j^{(l)} \delta_i^{(l+1)}$ or with vectorization, $\Delta^{(l)} := \Delta^{(l)} + \delta^{(l+1)}(a^{(l)})^T$ </li>
</ol>
<p>Hence we update our new $\Delta$  matrix.</p>
<ul>
<li>$D^{(l)}<em>{i,j} := \dfrac{1}{m}\left(\Delta^{(l)}</em>{i,j} + \lambda\Theta^{(l)}_{i,j}\right)​$ , if j≠0.</li>
<li>$D^{(l)}<em>{i,j} := \dfrac{1}{m}\Delta^{(l)}</em>{i,j}$  If j=0</li>
</ul>
<p>The capital-delta matrix D is used as an “accumulator” to add up our values as we go along and eventually compute our partial derivative. Thus we get $\frac \partial {\partial \Theta_{ij}^{(l)}} J(\Theta)$ </p>
<h2 id="Backpropagation-Intuition"><a href="#Backpropagation-Intuition" class="headerlink" title="Backpropagation Intuition"></a>Backpropagation Intuition</h2><p>Recall that the cost function for a neural network is:</p>
<p><em>J</em>(Θ)=−1<em>m</em>∑<em>t</em>=1<em>m</em>∑<em>k</em>=1<em>K</em>[<em>y</em>(<em>t</em>)<em>k</em> log(<em>h</em>Θ(<em>x</em>(<em>t</em>)))<em>k</em>+(1−<em>y</em>(<em>t</em>)<em>k</em>) log(1−<em>h</em>Θ(<em>x</em>(<em>t</em>))<em>k</em>)]+<em>λ</em>2<em>m</em>∑<em>l</em>=1<em>L</em>−1∑<em>i</em>=1<em>s**l</em>∑<em>j</em>=1<em>s**l</em>+1(Θ(<em>l</em>)<em>j</em>,<em>i</em>)2</p>
<p>If we consider simple non-multiclass classification (k = 1) and disregard regularization, the cost is computed with:</p>
<p>cost(t) =y^{(t)} \ \log (h_\Theta (x^{(t)})) + (1 - y^{(t)})\ \log (1 - h_\Theta(x^{(t)}))<em>c<strong>o</strong>s**t</em>(<em>t</em>)=<em>y</em>(<em>t</em>) log(<em>h</em>Θ(<em>x</em>(<em>t</em>)))+(1−<em>y</em>(<em>t</em>)) log(1−<em>h</em>Θ(<em>x</em>(<em>t</em>)))</p>
<p>Intuitively, $\delta_j^{(l)}$ is the “error” for $a^{(l)}_j$  (unit j in layer l). More formally, the delta values are actually the derivative of the cost function:</p>
<p>\delta_j^{(l)} = \dfrac{\partial}{\partial z_j^{(l)}} cost(t)<em>δ**j</em>(<em>l</em>)=∂<em>z**j</em>(<em>l</em>)∂<em>c<strong>o</strong>s**t</em>(<em>t</em>)</p>
<p>Recall that our derivative is the slope of a line tangent to the cost function, so the steeper the slope the more incorrect we are. Let us consider the following neural network below and see how we could calculate some $\delta_j^{(l)}$ :</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/qc309rdcEea4MxKdJPaTxA_324034f1a3c3a3be8e7c6cfca90d3445_fixx.png?expiry=1547942400000&amp;hmac=9W09X7txNTLIv74xKQ0J3-10so6-bjsxasOl8q6Ds1E" alt="img"></p>
<p>In the image above, to calculate $\delta_2^{(2)}$ , we multiply the weights $\Theta_{12}^{(2)}$  and $\Theta_{22}^{(2)} $ by their respective $\delta$  values found to the right of each edge. So we get $\delta_2^{(2)}= \Theta_{12}^{(2)}<em>\delta_1^{(3)} +\Theta_{22}^{(2)} </em>\delta_2^{(3)} $. To calculate every single possible $\delta_j^{(l)}$ , we could start from the right of our diagram. We can think of our edges as our $\Theta_{ij}$ . Going from right to left, to calculate the value of $\delta_j^{(l)}$ , you can just take the over all sum of each weight times the \delta<em>δ</em> it is coming from. Hence, another example would be $\delta_2^{(3)} =\Theta_{12}^{(3)} *\delta_1^{(4)} $.  </p>
<h2 id="Implementation-Note-Unrolling-Parameters"><a href="#Implementation-Note-Unrolling-Parameters" class="headerlink" title="Implementation Note: Unrolling Parameters"></a>Implementation Note: Unrolling Parameters</h2><p>With neural networks, we are working with sets of matrices:</p>
<p>Θ(1),Θ(2),Θ(3),…<em>D</em>(1),<em>D</em>(2),<em>D</em>(3),…</p>
<p>In order to use optimizing functions such as “fminunc()”, we will want to “unroll” all the elements and put them into one long vector:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">thetaVector = [ Theta1(:); Theta2(:); Theta3(:); ]</span><br><span class="line">deltaVector = [ D1(:); D2(:); D3(:) ]</span><br></pre></td></tr></table></figure>
<p>If the dimensions of Theta1 is 10x11, Theta2 is 10x11 and Theta3 is 1x11, then we can get back our original matrices from the “unrolled” versions as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Theta1 = reshape(thetaVector(1:110),10,11)</span><br><span class="line">Theta2 = reshape(thetaVector(111:220),10,11)</span><br><span class="line">Theta3 = reshape(thetaVector(221:231),1,11)</span><br></pre></td></tr></table></figure>
<p>To summarize:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/kdK7ubT2EeajLxLfjQiSjg_d35545b8d6b6940e8577b5a8d75c8657_Screenshot-2016-11-27-15.09.24.png?expiry=1547942400000&amp;hmac=DfCIbxo0s1GPhWBIr90Kn_Y7iQKj_qS61GebrAXtpKU" alt="img"></p>
<h2 id="Gradient-Checking"><a href="#Gradient-Checking" class="headerlink" title="Gradient Checking"></a>Gradient Checking</h2><p>Gradient checking will assure that our backpropagation works as intended. We can approximate the derivative of our cost function with:</p>
<p>$\dfrac{\partial}{\partial\Theta}J(\Theta) \approx \dfrac{J(\Theta + \epsilon) - J(\Theta - \epsilon)}{2\epsilon}​$ </p>
<p>With multiple theta matrices, we can approximate the derivative <strong>with respect to</strong> $Θ_j$  as follows:</p>
<p>$\dfrac{\partial}{\partial\Theta_j}J(\Theta) \approx \dfrac{J(\Theta_1, \dots, \Theta_j + \epsilon, \dots, \Theta_n) - J(\Theta_1, \dots, \Theta_j - \epsilon, \dots, \Theta_n)}{2\epsilon} ​$</p>
<p>A small value for ${\epsilon}$ (epsilon) such as ${\epsilon = 10^{-4}}$, guarantees that the math works out properly. If the value for $\epsilon$ is too small, we can end up with numerical problems.</p>
<p>Hence, we are only adding or subtracting epsilon to the $\Theta_j$  matrix. In octave we can do it as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">epsilon = 1e-4;</span><br><span class="line">for i = 1:n,</span><br><span class="line">  thetaPlus = theta;</span><br><span class="line">  thetaPlus(i) += epsilon;</span><br><span class="line">  thetaMinus = theta;</span><br><span class="line">  thetaMinus(i) -= epsilon;</span><br><span class="line">  gradApprox(i) = (J(thetaPlus) - J(thetaMinus))/(2*epsilon)</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<p>We previously saw how to calculate the deltaVector. So once we compute our gradApprox vector, we can check that gradApprox ≈ deltaVector.</p>
<p>Once you have verified <strong>once</strong> that your backpropagation algorithm is correct, you don’t need to compute gradApprox again. The code to compute gradApprox can be very slow.</p>
<h2 id="Random-Initialization"><a href="#Random-Initialization" class="headerlink" title="Random Initialization"></a>Random Initialization</h2><p>Initializing all theta weights to zero does not work with neural networks. When we backpropagate, all nodes will update to the same value repeatedly. Instead we can randomly initialize our weights for our  Θ matrices using the following method:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/y7gaS7pXEeaCrQqTpeD5ng_8868ccda2c387f5d481d0c54ab78a86e_Screen-Shot-2016-12-04-at-11.27.28-AM.png?expiry=1547942400000&amp;hmac=U_IaMoeaz8gW_sdj8_g3thSDAetZgOQ4e2gEzl9xn78" alt="img"></p>
<p>Hence, we initialize each $\Theta^{(l)}_{ij}$ to a random value between[−<em>ϵ</em>,<em>ϵ</em>]. Using the above formula guarantees that we get the desired bound. The same procedure applies to all the $\Theta​$’s. Below is some working code you could use to experiment.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">If the dimensions of Theta1 is 10x11, Theta2 is 10x11 and Theta3 is 1x11.</span><br><span class="line"></span><br><span class="line">Theta1 = rand(10,11) * (2 * INIT_EPSILON) - INIT_EPSILON;</span><br><span class="line">Theta2 = rand(10,11) * (2 * INIT_EPSILON) - INIT_EPSILON;</span><br><span class="line">Theta3 = rand(1,11) * (2 * INIT_EPSILON) - INIT_EPSILON;</span><br></pre></td></tr></table></figure>
<p>rand(x,y) is just a function in octave that will initialize a matrix of random real numbers between 0 and 1.</p>
<p>(Note: the epsilon used above is unrelated to the epsilon from Gradient Checking)</p>
<h2 id="Putting-it-Together"><a href="#Putting-it-Together" class="headerlink" title="Putting it Together"></a>Putting it Together</h2><p>First, pick a network architecture; choose the layout of your neural network, including how many hidden units in each layer and how many layers in total you want to have.</p>
<ul>
<li>Number of input units = dimension of features $x^{(i)}$</li>
<li>Number of output units = number of classes</li>
<li>Number of hidden units per layer = usually more the better (must balance with cost of computation as it increases with more hidden units)</li>
<li>Defaults: 1 hidden layer. If you have more than 1 hidden layer, then it is recommended that you have the same number of units in every hidden layer.</li>
</ul>
<p><strong>Training a Neural Network</strong></p>
<ol>
<li>Randomly initialize the weights</li>
<li>Implement forward propagation to get $h_\Theta(x^{(i)})$  for any $x^{(i)}$ </li>
<li>Implement the cost function</li>
<li>Implement backpropagation to compute partial derivatives</li>
<li>Use gradient checking to confirm that your backpropagation works. Then disable gradient checking.</li>
<li>Use gradient descent or a built-in optimization function to minimize the cost function with the weights in theta.</li>
</ol>
<p>When we perform forward and back propagation, we loop on every training example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for i = 1:m,</span><br><span class="line">   Perform forward propagation and backpropagation using example (x(i),y(i))</span><br><span class="line">   (Get activations a(l) and delta terms d(l) for l = 2,...,L</span><br></pre></td></tr></table></figure>
<p>The following image gives us an intuition of what is happening as we are implementing our neural network:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/hGk18LsaEea7TQ6MHcgMPA_8de173808f362583eb39cdd0c89ef43e_Screen-Shot-2016-12-05-at-10.40.35-AM.png?expiry=1547942400000&amp;hmac=RX0ny1aNs9AXuUCcCuDinDVMEHnC8n-Z9fzSLisf-3s" alt="img"></p>
<p>Ideally, you want $h_\Theta(x^{(i)}) \approx y^{(i)} $. This will minimize our cost function. However, keep in mind that  <em>J</em>(Θ) is not convex and thus we can end up in a local minimum instead.</p>
<h1 id="第六周"><a href="#第六周" class="headerlink" title="第六周"></a>第六周</h1><h2 id="Evaluating-a-Hypothesis"><a href="#Evaluating-a-Hypothesis" class="headerlink" title="Evaluating a Hypothesis"></a>Evaluating a Hypothesis</h2><p>Once we have done some trouble shooting for errors in our predictions by:</p>
<ul>
<li>Getting more training examples</li>
<li>Trying smaller sets of features</li>
<li>Trying additional features</li>
<li>Trying polynomial features</li>
<li>Increasing or decreasing λ</li>
</ul>
<p>We can move on to evaluate our new hypothesis.</p>
<p>A hypothesis may have a low error for the training examples but still be inaccurate (because of overfitting). Thus, to evaluate a hypothesis, given a dataset of training examples, we can split up the data into two sets: a <strong>training set</strong> and a <strong>test set</strong>. Typically, the training set consists of 70 % of your data and the test set is the remaining 30 %.</p>
<p>The new procedure using these two sets is then:</p>
<ol>
<li>Learn Θ and minimize $J_{train}(\Theta)$  using the training set</li>
<li>Compute the test set error $J_{test}(\Theta)​$ </li>
</ol>
<h3 id="The-test-set-error"><a href="#The-test-set-error" class="headerlink" title="The test set error"></a>The test set error</h3><ol>
<li>For linear regression: $J_{test}(\Theta) = \dfrac{1}{2m_{test}} \sum_{i=1}^{m_{test}}(h_\Theta(x^{(i)}<em>{test}) - y^{(i)}</em>{test})^2$</li>
<li>For classification ~ Misclassification error (aka 0/1 misclassification error):</li>
</ol>
<p><em>[Math Processing Error]</em></p>
<p>This gives us a binary 0 or 1 error result based on a misclassification. The average test error for the test set is:</p>
<p>$\text{Test Error} = \dfrac{1}{m_{test}} \sum^{m_{test}}<em>{i=1} err(h</em>\Theta(x^{(i)}<em>{test}), y^{(i)}</em>{test})$</p>
<p>This gives us the proportion of the test data that was misclassified.</p>
<h2 id="Model-Selection-and-Train-Validation-Test-Sets"><a href="#Model-Selection-and-Train-Validation-Test-Sets" class="headerlink" title="Model Selection and Train/Validation/Test Sets"></a>Model Selection and Train/Validation/Test Sets</h2><p>Just because a learning algorithm fits a training set well, that does not mean it is a good hypothesis. It could over fit and as a result your predictions on the test set would be poor. The error of your hypothesis as measured on the data set with which you trained the parameters will be lower than the error on any other data set.</p>
<p>Given many models with different polynomial degrees, we can use a systematic approach to identify the ‘best’ function. In order to choose the model of your hypothesis, you can test each degree of polynomial and look at the error result.</p>
<p>One way to break down our dataset into the three sets is:</p>
<ul>
<li>Training set: 60%</li>
<li>Cross validation set: 20%</li>
<li>Test set: 20%</li>
</ul>
<p>We can now calculate three separate error values for the three different sets using the following method:</p>
<ol>
<li>Optimize the parameters in Θ using the training set for each polynomial degree.</li>
<li>Find the polynomial degree d with the least error using the cross validation set.</li>
<li>Estimate the generalization error using the test set with $J_{test}(\Theta^{(d)})$ , (d = theta from polynomial with lower error);</li>
</ol>
<p>This way, the degree of the polynomial d has not been trained using the test set.</p>
<h2 id="Diagnosing-Bias-vs-Variance"><a href="#Diagnosing-Bias-vs-Variance" class="headerlink" title="Diagnosing Bias vs. Variance"></a>Diagnosing Bias vs. Variance</h2><p>In this section we examine the relationship between the degree of the polynomial d and the underfitting or overfitting of our hypothesis.</p>
<ul>
<li>We need to distinguish whether <strong>bias</strong> or <strong>variance</strong> is the problem contributing to bad predictions.</li>
<li>High bias is underfitting and high variance is overfitting. Ideally, we need to find a golden mean between these two.</li>
</ul>
<p>The training error will tend to <strong>decrease</strong> as we increase the degree d of the polynomial.</p>
<p>At the same time, the cross validation error will tend to <strong>decrease</strong> as we increase d up to a point, and then it will <strong>increase</strong> as d is increased, forming a convex curve.</p>
<p><strong>High bias (underfitting)</strong>: both $J_{train}(\Theta)$  and $J_{CV}(\Theta)$  will be high. Also, $J_{CV}(\Theta) \approx J_{train}(\Theta)$ </p>
<p><strong>High variance (overfitting)</strong>: $J_{train}(\Theta)$  will be low and$ J_{CV}(\Theta)$ will be much greater than $J_{train}(\Theta)$ </p>
<p>The is summarized in the figure below:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/I4dRkz_pEeeHpAqQsW8qwg_bed7efdd48c13e8f75624c817fb39684_fixed.png?expiry=1548028800000&amp;hmac=gsvJ8uix6E9ki-r6G_cFtU8qicfsffnPMzsjAlLZvVk" alt="img"></p>
<h2 id="Regularization-and-Bias-Variance"><a href="#Regularization-and-Bias-Variance" class="headerlink" title="Regularization and Bias/Variance"></a>Regularization and Bias/Variance</h2><p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/3XyCytntEeataRJ74fuL6g_3b6c06d065d24e0bf8d557e59027e87a_Screenshot-2017-01-13-16.09.36.png?expiry=1548028800000&amp;hmac=iK2Q7ZWg7ZZUeg5KjhWiI8uj-n6icsuaxRo9A5eIitU" alt="img"></p>
<p>In the figure above, we see that as  <em>λ</em> increases, our fit becomes more rigid. On the other hand, as  λ* approaches 0, we tend to over overfit the data. So how do we choose our parameter $\lambda$to get it ‘just right’ ? In order to choose the model and the regularization term λ, we need to:</p>
<ol>
<li>Create a list of lambdas (i.e. λ∈{0,0.01,0.02,0.04,0.08,0.16,0.32,0.64,1.28,2.56,5.12,10.24});</li>
<li>Create a set of models with different degrees or any other variants.</li>
<li>Iterate through the $\lambda$s and for each $\lambda$  go through all the models to learn some $\Theta$.</li>
<li>Compute the cross validation error using the learned Θ (computed with λ) on the $J_{CV}(\Theta)​$ <strong>without</strong> regularization or λ = 0.</li>
<li>Select the best combo that produces the lowest error on the cross validation set.</li>
<li>Using the best combo Θ and λ, apply it on$ J_{test}(\Theta)$ to see if it has a good generalization of the problem.</li>
</ol>
<h2 id="Learning-Curves"><a href="#Learning-Curves" class="headerlink" title="Learning Curves"></a>Learning Curves</h2><p>Training an algorithm on a very few number of data points (such as 1, 2 or 3) will easily have 0 errors because we can always find a quadratic curve that touches exactly those number of points. Hence:</p>
<ul>
<li>As the training set gets larger, the error for a quadratic function increases.</li>
<li>The error value will plateau out after a certain m, or training set size.</li>
</ul>
<p><strong>Experiencing high bias:</strong></p>
<p><strong>Low training set size</strong>: causes $ J_{train}(\Theta)​$  to be low and $J_{CV}(\Theta)​$ to be high.</p>
<p><strong>Large training set size</strong>: causes both $J_{train}(\Theta)$ and $J_{CV}(\Theta)$  to be high with $J_{train}(\Theta) ≈J_{CV}(\Theta) .$</p>
<p>If a learning algorithm is suffering from <strong>high bias</strong>, getting more training data will not <strong>(by itself)</strong> help much.</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/bpAOvt9uEeaQlg5FcsXQDA_ecad653e01ee824b231ff8b5df7208d9_2-am.png?expiry=1548028800000&amp;hmac=Ea_WV56Wbl0MUHEnX3y3Cy2zsgxpumi2RNH-T-1Fd-I" alt="img"></p>
<p><strong>Experiencing high variance:</strong></p>
<p><strong>Low training set size</strong>: $J_{train}(\Theta)$  will be low and $J_{CV}(\Theta)$ will be high.</p>
<p><strong>Large training set size</strong>: $J_{train}(\Theta)$  increases with training set size and $J_{CV}(\Theta)$ continues to decrease without leveling off. Also, $J_{train}(\Theta)$  &lt; $J_{CV}(\Theta)$  but the difference between them remains significant.</p>
<p>If a learning algorithm is suffering from <strong>high variance</strong>, getting more training data is likely to help.</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/vqlG7t9uEeaizBK307J26A_3e3e9f42b5e3ce9e3466a0416c4368ee_ITu3antfEeam4BLcQYZr8Q_37fe6be97e7b0740d1871ba99d4c2ed9_300px-Learning1.png?expiry=1548028800000&amp;hmac=6p2C-RcNvb1bpDibx4tq1D3prwR8rt_kLVx1TCIetsY" alt="img"></p>
<h2 id="Deciding-What-to-Do-Next-Revisited"><a href="#Deciding-What-to-Do-Next-Revisited" class="headerlink" title="Deciding What to Do Next Revisited"></a>Deciding What to Do Next Revisited</h2><p>Our decision process can be broken down as follows:</p>
<ul>
<li><p><strong>Getting more training examples:</strong> Fixes high variance</p>
</li>
<li><p><strong>Trying smaller sets of features:</strong> Fixes high variance</p>
</li>
<li><p><strong>Adding features:</strong> Fixes high bias</p>
</li>
<li><p><strong>Adding polynomial features:</strong> Fixes high bias</p>
</li>
<li><p><strong>Decreasing λ:</strong> Fixes high bias</p>
</li>
<li><p><strong>Increasing λ:</strong> Fixes high variance.</p>
</li>
</ul>
<h3 id="Diagnosing-Neural-Networks"><a href="#Diagnosing-Neural-Networks" class="headerlink" title="Diagnosing Neural Networks"></a><strong>Diagnosing Neural Networks</strong></h3><ul>
<li>A neural network with fewer parameters is <strong>prone to underfitting</strong>. It is also <strong>computationally cheaper</strong>.</li>
<li>A large neural network with more parameters is <strong>prone to overfitting</strong>. It is also <strong>computationally expensive</strong>. In this case you can use regularization (increase λ) to address the overfitting.</li>
</ul>
<p>Using a single hidden layer is a good starting default. You can train your neural network on a number of hidden layers using your cross validation set. You can then select the one that performs best.</p>
<p><strong>Model Complexity Effects:</strong></p>
<ul>
<li>Lower-order polynomials (low model complexity) have high bias and low variance. In this case, the model fits poorly consistently.</li>
<li>Higher-order polynomials (high model complexity) fit the training data extremely well and the test data extremely poorly. These have low bias on the training data, but very high variance.</li>
<li>In reality, we would want to choose a model somewhere in between, that can generalize well but also fits the data reasonably well.</li>
</ul>
<h2 id="Building-a-Spam-Classifier"><a href="#Building-a-Spam-Classifier" class="headerlink" title="Building a Spam Classifier"></a>Building a Spam Classifier</h2><h3 id="Prioritizing-What-to-Work-On"><a href="#Prioritizing-What-to-Work-On" class="headerlink" title="Prioritizing What to Work On"></a>Prioritizing What to Work On</h3><p><strong>System Design Example:</strong></p>
<p>Given a data set of emails, we could construct a vector for each email. Each entry in this vector represents a word. The vector normally contains 10,000 to 50,000 entries gathered by finding the most frequently used words in our data set. If a word is to be found in the email, we would assign its respective entry a 1, else if it is not found, that entry would be a 0. Once we have all our x vectors ready, we train our algorithm and finally, we could use it to classify if an email is a spam or not.</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/Ys5NKOLJEeaPWBJZo44gSg_aba93cf4ce4507175d7e47ab5f9b7ce4_Screenshot-2017-01-24-22.29.45.png?expiry=1548028800000&amp;hmac=Y9thbF3VNy5CuAn6C9x3uEUOgM8qd7WBUte0rT1qr1M" alt="img"></p>
<p>So how could you spend your time to improve the accuracy of this classifier?</p>
<ul>
<li>Collect lots of data (for example “honeypot” project but doesn’t always work)</li>
<li>Develop sophisticated features (for example: using email header data in spam emails)</li>
<li>Develop algorithms to process your input in different ways (recognizing misspellings in spam).</li>
</ul>
<p>It is difficult to tell which of the options will be most helpful.</p>
<h2 id="Error-Analysis"><a href="#Error-Analysis" class="headerlink" title="Error Analysis"></a>Error Analysis</h2><p>The recommended approach to solving machine learning problems is to:</p>
<ul>
<li>Start with a simple algorithm, implement it quickly, and test it early on your cross validation data.</li>
<li>Plot learning curves to decide if more data, more features, etc. are likely to help.</li>
<li>Manually examine the errors on examples in the cross validation set and try to spot a trend where most of the errors were made.</li>
</ul>
<p>For example, assume that we have 500 emails and our algorithm misclassifies a 100 of them. We could manually analyze the 100 emails and categorize them based on what type of emails they are. We could then try to come up with new cues and features that would help us classify these 100 emails correctly. Hence, if most of our misclassified emails are those which try to steal passwords, then we could find some features that are particular to those emails and add them to our model. We could also see how classifying each word according to its root changes our error rate:</p>
<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/kky-ouM6EeacbA6ydECl3A_01b1fa64fcc9a7eb5da8e946f6a12636_Screenshot-2017-01-25-12.08.23.png?expiry=1548028800000&amp;hmac=1o9pxek1pIwohLfdIFT5_pj8P2GzBKTf6oMU3HKv2h0" alt="img"></p>
<p>It is very important to get error results as a single, numerical value. Otherwise it is difficult to assess your algorithm’s performance. For example if we use stemming, which is the process of treating the same word with different forms (fail/failing/failed) as one word (fail), and get a 3% error rate instead of 5%, then we should definitely add it to our model. However, if we try to distinguish between upper case and lower case letters and end up getting a 3.2% error rate instead of 3%, then we should avoid using this new feature. Hence, we should try new things, get a numerical value for our error rate, and based on our result decide whether we want to keep the new feature or not.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/26/MySQL性能优化/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/26/MySQL性能优化/" itemprop="url">MySQL性能优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-26T18:42:50+08:00">
                2019-01-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/26/MySQL性能优化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/26/MySQL性能优化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-性能优化概述"><a href="#1-性能优化概述" class="headerlink" title="1.性能优化概述"></a>1.性能优化概述</h2><p>​    只有当长时间运行，并且有大量用户进行频繁操作时，MySQL数据库的性能优劣就会体现出来。</p>
<p>​    在优化之前，可以通过<strong>show status</strong>语句或者<strong>mysqladmin</strong>命令查看mysql服务器的状态信息。</p>
<p>​    show status语句的相关变量很多，下面给出一些常用的：</p>
<p>​    connections：连接MySQL服务器的次数</p>
<p>​    com_select：查询操作的次数</p>
<p>​    com_insert：插入操作的次数</p>
<p>​    com_update：更新操作的次数</p>
<p>​    com_delete：删除操作的次数</p>
<p>​    slow_queries：慢查询的次数</p>
<p>​    uptime：MySQL服务器的上线时间</p>
<p>​    Innodb_rows_deleted：delete语句删除的记录数</p>
<p>​    <code>show status like &#39;connections&#39;;</code></p>
<h2 id="2-优化查询"><a href="#2-优化查询" class="headerlink" title="2.优化查询"></a>2.优化查询</h2><h3 id="2-1-分析语句查询"><a href="#2-1-分析语句查询" class="headerlink" title="2.1 分析语句查询"></a>2.1 分析语句查询</h3><p>​    可以使用explain语句和describe语句来分析查询语句。</p>
<p>​    <code>explain select 语句;</code></p>
<p>​    <code>describe select 语句;</code></p>
<h3 id="2-2-索引对查询速度的影响"><a href="#2-2-索引对查询速度的影响" class="headerlink" title="2.2 索引对查询速度的影响"></a>2.2 索引对查询速度的影响</h3><p>​    索引可以快速地定位表中的某条记录。使用索引可以提高数据库查询的速度，从而提高数据库的性能。</p>
<h3 id="2-3-使用索引查询"><a href="#2-3-使用索引查询" class="headerlink" title="2.3 使用索引查询"></a>2.3 使用索引查询</h3><p>​    索引可以提高查询的速度。但是有些时候即使查询时使用的是索引，但索引并没有起作用。</p>
<p>​    <strong>1.查询语句中使用like关键字</strong></p>
<p>​    使用like关键字进行查询时，如果匹配字符串的第一个字符是’%‘，索引不会被使用。</p>
<p>​    <strong>2.查询语句中使用多列索引</strong></p>
<p>​    多列索引是在表的多个字段上创建一个索引。只有查询条件中使用了这些字段中的第一个字段时，索引才会被使用。</p>
<p>​    <strong>3.查询语句中使用or关键字</strong></p>
<p>​    查询语句只有or关键字，如果or前后的两个条件的列都是索引，查询中将使用索引，如果or前后有一个条件的列不是索引，那么查询中将不使用索引。</p>
<h3 id="2-4-优化子查询"><a href="#2-4-优化子查询" class="headerlink" title="2.4 优化子查询"></a>2.4 优化子查询</h3><p>​    进行子查询时，MySQL需要为内层查询语句的查询结果建立一个临时表，然后外层查询语句在临时表中查询记录。查询完毕后，MySQL需要撤销这些临时表。因此，子查询的速度会受到一定影响。</p>
<p>​    在MySQL中可以使用<strong>join连接</strong>查询来代替子查询。连接查询不需要建立临时表，其速度要比子查询块。</p>
<h3 id="2-5-优化查询基本原则"><a href="#2-5-优化查询基本原则" class="headerlink" title="2.5 优化查询基本原则"></a>2.5 优化查询基本原则</h3><p>​    1）尽量早过滤</p>
<p>​    2）尽量用join查询代替子查询</p>
<p>​    3）尽量少排序</p>
<p>​    4）从全局出发，而不是片面调整</p>
<h2 id="3-优化数据库结构"><a href="#3-优化数据库结构" class="headerlink" title="3.优化数据库结构"></a>3.优化数据库结构</h2><p>​    数据库结构是否合理，需要考虑是否存在冗余、对表的查询和更新的速度、表中字段的数据类型是否合理等多方面的内容。</p>
<h3 id="3-1-将字段很多的表分解成多个表"><a href="#3-1-将字段很多的表分解成多个表" class="headerlink" title="3.1 将字段很多的表分解成多个表"></a>3.1 将字段很多的表分解成多个表</h3><p>​    有些表有很多个字段，其中某些字段使用频率较低，可以分解这个表，将不频繁使用的字段分在一起。</p>
<h3 id="3-2-增加中间表"><a href="#3-2-增加中间表" class="headerlink" title="3.2 增加中间表"></a>3.2 增加中间表</h3><p>​    如果经常进行联表查询，会降低MySQL数据库的查询速度。可以建立中间表来解决。</p>
<p>​    将经常需要同时查询的几个表中的几个字段建立成一个中间表。</p>
<h3 id="3-3-增加冗余字段"><a href="#3-3-增加冗余字段" class="headerlink" title="3.3 增加冗余字段"></a>3.3 增加冗余字段</h3><p>​    设计数据库表时尽量达到第三范式要求。但是，有时为了查询速度，可以有意识地在表中增加冗余字段。</p>
<h3 id="3-4-优化插入记录的速度"><a href="#3-4-优化插入记录的速度" class="headerlink" title="3.4 优化插入记录的速度"></a>3.4 优化插入记录的速度</h3><p>​    插入记录时，索引、唯一性校验都会影响到插入记录的速度。而且，一次插入多条记录和多次插入记录所耗费的时间是不一样的。</p>
<p>​    <strong>1.禁用索引</strong></p>
<p>​    插入记录时，MySQL会根据表的索引对插入的记录进行排序。当插入大量数据时，这些排序会降低插入速度。所以要在插入前先禁用索引。等到插入完毕后再开启索引。</p>
<p>​    禁用索引：<code>alter table table_name disable keys;</code></p>
<p>​    开启索引：<code>alter table table_name enable keys;</code></p>
<p>​    <strong>2.禁用唯一性检查</strong></p>
<p>​    在插入前先禁用唯一性检查：<code>set unique_checks = 0;</code>，插入完毕再开启：<code>set unique_checks=1;</code>。</p>
<p>​    <strong>3.优化insert语句</strong></p>
<p>​    插入多条记录时，推荐使用一个insert语句插入多条记录的方式，减少了与数据库之间的连接等操作，速度比多条insert快。</p>
<p>​    并且，如果可以用load data infile语句的话就尽量使用，其导入数据的速度比insert快。</p>
<h3 id="3-5-分析表、检查表和优化表"><a href="#3-5-分析表、检查表和优化表" class="headerlink" title="3.5 分析表、检查表和优化表"></a>3.5 分析表、检查表和优化表</h3><p>​    <strong>1.分析表</strong></p>
<p>​    分析表的作用主要是分析关键字的分布。</p>
<p>​    <code>analyze table tb_name1 [tb_name2..];</code></p>
<p>​    使用analyze table分析表的过程中，数据库系统会对表加一个只读锁。在分析期间，只能读取表中的记录，不能更新和插入记录。</p>
<p>​    <strong>2.检查表</strong></p>
<p>​    检查表的主要作用是检查表是否存在错误。</p>
<p>​    <code>check table tb_name1 [tb_name2..] option;</code></p>
<p>​    其中，option有5个参数，分别是quick、fast、changed、medium和extended。5个参数的执行效率依次降低。option只对MyISAM有效，对InnoDB无效。check table过程中也会对表上锁。</p>
<p>​    <strong>3.优化表</strong></p>
<p>​    优化表的主要作用是消除删除或者更新造成的空间浪费。</p>
<p>​    optimize table语句只能优化表中的varchar、blob和text类型的字段。</p>
<p>​    <code>optimize table table tb_name1 [tb_name2..];</code></p>
<p>​    optimize table语句在执行过程中也会给表加上锁。</p>
<p>​    如果一个表使用了text或者blob这样的数据类型，那么更新、删除等操作就会造成磁盘空间的浪费。因为更新和删除操作后，以前分配的磁盘空间不会自动回收。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/26/MySQL日志管理/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/26/MySQL日志管理/" itemprop="url">MySQL日志管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-26T13:42:50+08:00">
                2019-01-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/26/MySQL日志管理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/26/MySQL日志管理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-MySQL支持的日志"><a href="#1-MySQL支持的日志" class="headerlink" title="1.MySQL支持的日志"></a>1.MySQL支持的日志</h2><p>​    MySQL日志是用来记录MySQL数据库的客户端连接情况、SQL语句的执行情况、错误信息等。</p>
<p>​    MySQL日志可以分为四种：二进制日志、错误日志、通用查询日志和慢查询日志。</p>
<p>​    <strong>二进制日志</strong>：以二进制文件的形式记录了数据库中的操作，但不记录查询语句。</p>
<p>​    <strong>错误日志</strong>：记录MySQL服务器的启动、关闭、运行错误等信息。</p>
<p>​    <strong>通用查询日志</strong>：记录用户登录和记录查询的操作。</p>
<p>​    <strong>慢查询日志</strong>：记录执行时间超过指定时间的操作。</p>
<p>​    除二进制日志外，其他都是文本文件。默认情况下，只启动了错误日志的功能。启动日志功能会降低MySQL数据库的执行速度。</p>
<h2 id="2-错误日志"><a href="#2-错误日志" class="headerlink" title="2.错误日志"></a>2.错误日志</h2><h3 id="2-1-启动"><a href="#2-1-启动" class="headerlink" title="2.1 启动"></a>2.1 启动</h3><p>​    默认开启且无法被禁止，存储在MySQL数据库的数据文件夹下。错误日志文件的名称通常为host-name.err。</p>
<p>​    错误日志的存储位置可以通过log -error选项来设置。将log -error选项加入到my.ini文件的[mysqld]组中，形式如下：<code>log -error[ = DIR/[filename]]</code></p>
<h3 id="2-2-删除"><a href="#2-2-删除" class="headerlink" title="2.2 删除"></a>2.2 删除</h3><p>​    数据库管理员可以删除很久之前的错误日志，以保证足够的硬盘空间。</p>
<p>​    <code>mysqladmin -u root -p flush -logs</code></p>
<p>​    执行该命令后，数据库系统会自动创建一个新的错误日志。旧的错误日志仍然保留着，只是已经更名为filename.err-old。</p>
<p>​    还可以使用<em>flush logs</em>语句来开启新的错误日志。</p>
<h2 id="3-二进制日志"><a href="#3-二进制日志" class="headerlink" title="3.二进制日志"></a>3.二进制日志</h2><p>​    二进制日志又称变更日志，主要用于记录数据库的变化情况。</p>
<h3 id="3-1-启动"><a href="#3-1-启动" class="headerlink" title="3.1 启动"></a>3.1 启动</h3><p>​    默认下是关闭的。通过my.ini的log - bin选项可以开启二进制日志。将log - bin选项加入到my.ini文件的[mysqld]组中，形式如下：<code>log - bin[ = DIR/[filename]]</code></p>
<p>​    filename参数指定二进制文件的文件名，其形式为filename.number，number的形式为000001、000002等。每次重启MySQL服务后，都会生成一个新的二进制日志文件，这些number会不断递增。除了生成上述文件外，还会生成一个名为filename.Index的文件，这个文件中存储所有二进制日志文件的清单。</p>
<p>​    二进制日志与数据库的数据文件最好不要放在同一块硬盘上。数据损坏时可恢复。</p>
<h3 id="3-2-查看"><a href="#3-2-查看" class="headerlink" title="3.2 查看"></a>3.2 查看</h3><p>​    <code>mysqlbinlog filename.number</code></p>
<p>​    该命令将在当前文件夹下查找指定的二进制日志。</p>
<h3 id="3-3-删除"><a href="#3-3-删除" class="headerlink" title="3.3 删除"></a>3.3 删除</h3><p>​    <strong>1.删除所有二进制日志</strong></p>
<p>​    <code>reset master;</code></p>
<p>​    <strong>2.根据编号来删除二进制日志</strong></p>
<p>​    每个二进制日志文件后有一个六位的编号。使用purge master logs to语句可以删除小于这个二进制日志的所有二进制日志。</p>
<p>​    <code>purge master logs to &#39;filename.number&#39;;</code></p>
<p>​    <strong>3.根据创建时间来删除二进制日志</strong></p>
<p>​    使用purge master logs before语句可以删除指定时间之前创建的二进制日志。</p>
<p>​    <code>purge master logs before &#39;yyyy-mm-dd hh:mm:ss&#39;;</code></p>
<h3 id="3-4-二进制日志还原数据库"><a href="#3-4-二进制日志还原数据库" class="headerlink" title="3.4 二进制日志还原数据库"></a>3.4 二进制日志还原数据库</h3><p>​    一旦数据库遭到破坏，可以使用二进制日志来还原数据库。</p>
<p>​    <code>mysqlbinlog filename.number | mysql -u root -p</code></p>
<p>​    在还原时，必须是编号小的先还原。</p>
<p>​    可以使用set语句来暂停二进制日志功能：<code>SET SQL_LOG_BIN = 0;</code></p>
<h2 id="4-慢查询日志"><a href="#4-慢查询日志" class="headerlink" title="4.慢查询日志"></a>4.慢查询日志</h2><h3 id="4-1-启动"><a href="#4-1-启动" class="headerlink" title="4.1 启动"></a>4.1 启动</h3><p>​    修改my.ini文件的<strong>slow_query_log</strong>选项可以开启慢查询日志。slow_query_log_file设置日志路径，long_query_time设置时间值。日志文件名为filename - slow.log。</p>
<h3 id="4-3-删除"><a href="#4-3-删除" class="headerlink" title="4.3 删除"></a>4.3 删除</h3><p>​    慢查询日志既可以用mysqladmin命令来删除，也可以使用手工方式。</p>
<p>​    <code>mysqladmin -u root -p flush -logs</code></p>
<p>​    新的慢查询日志会覆盖旧的。</p>
<h2 id="5-通用查询日志"><a href="#5-通用查询日志" class="headerlink" title="5.通用查询日志"></a>5.通用查询日志</h2><h3 id="5-1-启动"><a href="#5-1-启动" class="headerlink" title="5.1 启动"></a>5.1 启动</h3><p>​    在my.ini文件中的[mysqld]组，把general - log的值设置为1，即为开启。general_log_file表示路径。</p>
<p>​    默认文件名为hostname.log。</p>
<h3 id="5-2-删除"><a href="#5-2-删除" class="headerlink" title="5.2 删除"></a>5.2 删除</h3><p>​    <code>mysqladmin -u root -p flush -logs</code></p>
<p>​    也可手动。想保留旧的必须先备份。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/25/事务与MySQL的多用户并发控制/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/25/事务与MySQL的多用户并发控制/" itemprop="url">事务与MySQL的多用户并发控制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-25T19:42:50+08:00">
                2019-01-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/25/事务与MySQL的多用户并发控制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/25/事务与MySQL的多用户并发控制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-事务"><a href="#1-事务" class="headerlink" title="1.事务"></a>1.事务</h2><h3 id="1-1-事务的概念"><a href="#1-1-事务的概念" class="headerlink" title="1.1 事务的概念"></a>1.1 事务的概念</h3><pre><code>指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行。 事务处理可以确保除非事务性单元内的所有操作都成功完成，否则不会永久更新面向数据的资源。通过将一组相关操作组合为一个要么全部成功要么全部失败的单元，可以简化错误恢复并使应用程序更加可靠。
</code></pre><p>​    设想网上购物的一次交易，其付款过程至少包括以下几步数据库操作：</p>
<p>​    一、更新客户所购商品的库存信息</p>
<p>​    二、保存客户付款信息–可能包括与银行系统的交互</p>
<p>​    三、生成订单并且保存到数据库中</p>
<p>​    四、更新用户相关信息，例如购物数量等等</p>
<p>​    正常的情况下，这些操作将顺利进行，最终交易成功，与交易相关的所有数据库信息也成功地更新。但是，如果在这一系列过程中任何一个环节出了差错，例如在更新商品库存信息时发生异常、该顾客银行帐户存款不足等，都将导致交易失败。一旦交易失败，数据库中所有信息都必须保持交易前的状态不变，比如最后一步更新用户信息时失败而导致交易失败，那么必须保证这笔失败的交易不影响数据库的状态–库存信息没有被更新、用户也没有付款，订单也没有生成。否则，数据库的信息将会一片混乱而不可预测。</p>
<p>​    数据库事务正是用来保证这种情况下交易的平稳性和可预测性的技术。</p>
<h3 id="1-2-事务的ACID特性"><a href="#1-2-事务的ACID特性" class="headerlink" title="1.2 事务的ACID特性"></a>1.2 事务的ACID特性</h3><p>​    每个事务的处理必须满足ACID原则，即原子性（A）、一致性（C）、隔离性（I）和持久性（D）。</p>
<p>​    <strong>1.原子性（Atomicity）</strong></p>
<p>​    事务必须是原子工作单元；对于其数据修改，要么全都执行，要么全都不执行。通常，与某个事务关联的操作具有共同的目标，并且是相互依赖的。如果系统只执行这些操作的一个子集，则可能会破坏事务的总体目标。原子性消除了系统处理操作子集的可能性。</p>
<p>​    <strong>2.一致性（Consistency）</strong></p>
<p>​    事务在完成时，必须使所有的数据都保持一致状态。在相关数据库中，所有规则都必须应用于事务的修改，以保持所有数据的完整性。事务结束时，所有的内部数据结构（如 B 树索引或双向链表）都必须是正确的。某些维护一致性的责任由应用程序开发人员承担，他们必须确保应用程序已强制所有已知的完整性约束。例如，当开发用于转帐的应用程序时，应避免在转帐过程中任意移动小数点。</p>
<p>​    <strong>3.隔离性（Isolation）</strong></p>
<p>​    由并发事务所作的修改必须与任何其它并发事务所作的修改隔离。事务查看数据时数据所处的状态，要么是另一并发事务修改它之前的状态，要么是另一事务修改它之后的状态，事务不会查看中间状态的数据。这称为隔离性，因为它能够重新装载起始数据，并且重播一系列事务，以使数据结束时的状态与原始事务执行的状态相同。当事务可序列化时将获得最高的隔离级别。在此级别上，从一组可并行执行的事务获得的结果与通过连续运行每个事务所获得的结果相同。由于高度隔离会限制可并行执行的事务数，所以一些应用程序降低隔离级别以换取更大的吞吐量。</p>
<p>​    <strong>4.持久性（Durability）</strong></p>
<p>​    事务完成之后，它对于系统的影响是永久性的。该修改即使出现致命的系统故障也将一直保持。</p>
<h3 id="1-3-MySQL事务控制语句"><a href="#1-3-MySQL事务控制语句" class="headerlink" title="1.3 MySQL事务控制语句"></a>1.3 MySQL事务控制语句</h3><p>​    MySQL中可以使用begin开始事务，使用commit结束事务，中间可以使用rollback回滚事务。MySQL通过set autocommit、start transaction、commit和rollback等语句支持本地事务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set autocommit=&#123;0|1&#125;</span><br><span class="line">start transaction | begin [work]</span><br><span class="line">commit [work] [and [no] chain] [[no] release]</span><br><span class="line">rollback [work] [and [no] chain] [[no] release]</span><br></pre></td></tr></table></figure>
<p>​    默认情况下，MySQL是autocommit的。</p>
<p>​    chain和release子句分别用来定义在事务提交或回滚之后的操作，chain会立即启动一个新事务，并且和刚才的事务具有相同的隔离级别，release则会断开和客户端的连接。</p>
<p>​    如果只是对某些语句需要进行事务控制，则使用start transaction开始一个事务比较方便，这样事务结束后可以自动回到自动提交的方式。</p>
<h3 id="1-4-事务的隔离级别"><a href="#1-4-事务的隔离级别" class="headerlink" title="1.4 事务的隔离级别"></a>1.4 事务的隔离级别</h3><p>​    每一个事务都有一个所谓的隔离级，它定义了用户彼此之间隔离和交互的程度。</p>
<p>​    为了了解隔离的重要性，有必要花些时间来考虑如果不强加隔离会发生什么。如果没有事务的隔离性，不同的SELECT语句将会在同一个事务的环境中检索到不同的结果，因为在这期间，基本上数据已经被其它事务所修改。这将导致不一致性。</p>
<p>​    MySQL提供了以下四种隔离级：</p>
<p>​    <strong>1.序列化</strong></p>
<p>​    <code>set [global|session] transaction isolation level serializable</code></p>
<p>​    用户之间通过一个接一个顺序地执行当前事务。可避免脏读、不可重复读、幻读的发生。</p>
<p>​    <strong>2.可重复读</strong></p>
<p>​    <code>set [global|session] transaction isolation level repeatable read</code></p>
<p>​    事务不会被看成一个序列。不过，当前在执行事务的变化仍然不能看到，也就是说，在同一个事务中的多此同条select语句的执行结果是相同的。可避免脏读、不可重复读的发生。</p>
<p>​    <strong>3.提交读</strong></p>
<p>​    <code>set [global|session] transaction isolation level read committed</code></p>
<p>​    不仅处于这一级的事务可以看到其他事务添加的新记录，而且其他事务对现存记录做出的修改一旦被提交，也可以看到。也就是说，在同一个事务中的多此同条select语句的执行结果是可能不相同的。可避免脏读的发生。</p>
<p>​    <strong>4.未提交读</strong></p>
<p>​    <code>set [global|session] transaction isolation level read uncommitted</code></p>
<p>​    处于这个隔离级的事务可以读到其他事务还没有提交的数据。最低级别，任何情况都无法保证。</p>
<p>​    语句中如果指定global，那么定义的隔离级将适用于所有的SQL用户；如果指定session，则隔离级只适用于当前运行的会话和连接。MySQL默认为repeatable read隔离级。</p>
<h2 id="2-MySQL的并发控制"><a href="#2-MySQL的并发控制" class="headerlink" title="2.MySQL的并发控制"></a>2.MySQL的并发控制</h2><p>​    在单处理机系统中，事务的并行执行实际上是这些并行事务轮流交叉进行，这种并行执行方式称为交叉并发方式。</p>
<p>​    在多处理机系统中，每个处理机可以运行一个事务，多个处理机可以同时运行多个事务，实现事务真正的并发运行，这种并发执行方式称为同时并发方式。</p>
<h3 id="2-1-并发概述"><a href="#2-1-并发概述" class="headerlink" title="2.1 并发概述"></a>2.1 并发概述</h3><p>​    当多个用户并发地存取数据库时就会产生多个事务同时存取同一个数据的情况。若对并发操作不加控制，可能会存取和存储不正确的数据，就会出现数据的不一致问题。</p>
<p>​    <strong>1.丢失更新（lost update）问题</strong></p>
<p>​    当两个或多个事务选择同一行，然后基于最初选定的值更新该行时，由于每个事务都不知道其他事务的存在，就会发生丢失更新问题——最后的更新覆盖了由其他事务所做的更新。</p>
<p>​    <strong>2.脏读（dirty read）问题</strong></p>
<p>​    一个事务处理过程里读取了另一个未提交的事务中的数据。当一个事务正在多次修改某个数据，而在这个事务中这多次的修改都还未提交，这时一个并发的事务来访问该数据，就会造成两个事务得到的数据不一致。</p>
<pre><code>**3.不可重复读（unrepeatable read）问题**
</code></pre><p>​    对于数据库中的某个数据，一个事务范围内多次查询却返回了不同的数据值，这是由于在查询间隔，被另一个事务修改并提交了。例如事务T1在读取某一数据，而事务T2立马修改了这个数据并且提交事务给数据库，事务T1再次读取该数据就得到了不同的结果，发送了不可重复读。</p>
<p>　　不可重复读和脏读的区别是，脏读是某一事务读取了另一个事务未提交的脏数据，而不可重复读则是读取了前一事务提交的数据。</p>
<p>　　在某些情况下，不可重复读并不是问题，比如我们多次查询某个数据当然以最后查询得到的结果为主。但在另一些情况下就有可能发生问题，例如对于同一个数据A和B依次查询就可能不同，A和B就可能打起来了……</p>
<p>​    <strong>4.幻读（phantom read）问题</strong></p>
<p>​    幻读是事务非独立执行时发生的一种现象。例如事务T1对一个表中所有的行的某个数据项做了从“1”修改为“2”的操作，这时事务T2又对这个表中插入了一行数据项，而这个数据项的数值还是为“1”并且提交给数据库。而操作事务T1的用户如果再查看刚刚修改的数据，会发现还有一行没有修改，其实这行是从事务T2中添加的，就好像产生幻觉一样，这就是发生了幻读。</p>
<p>　　幻读和不可重复读都是读取了另一条已经提交的事务（这点就脏读不同），所不同的是不可重复读查询的都是同一个数据项，而幻读针对的是一批数据整体（比如数据的个数）。</p>
<h3 id="2-2-锁的概念"><a href="#2-2-锁的概念" class="headerlink" title="2.2 锁的概念"></a>2.2 锁的概念</h3><p>​    锁定可以防止用户读取正在被其他用户更改的数据，并防止多个用户同时更改相同数据。</p>
<p>​    MyISAM和MEMORY存储引擎采用的是表级锁。</p>
<p>​    BDB存储引擎采用的是页面锁，但也支持表级锁。</p>
<p>​    InnoDB存储引擎既支持行级锁，也支持表级锁，默认为行级锁。</p>
<p>​    三种锁的特点如下：</p>
<p>​    1）表级锁：一个特殊类型的访问，整个表被客户锁定。开销小，加锁快，不会出现死锁，并发度最低。</p>
<p>​    2）页面锁：MySQL将锁定表中的某些行称为页。会出现死锁。</p>
<p>​    3）行级锁：被线程使用的行是锁定的。开销大，加锁慢，会出现死锁，并发度最高。</p>
<p>​    表级锁更适合于以查询为主。而行级锁更适合于有大量按索引条件并发更新少量不同数据，同时又有并发查询的应用。</p>
<p>​    只有通过索引条件检索数据，InnoDB才使用行级锁，否则，将使用表级锁。</p>
<p>### </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/25/MySQL数据库备份与还原/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/25/MySQL数据库备份与还原/" itemprop="url">MySQL数据库备份与还原</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-25T13:42:50+08:00">
                2019-01-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/25/MySQL数据库备份与还原/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/25/MySQL数据库备份与还原/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  891
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-备份与还原概述"><a href="#1-备份与还原概述" class="headerlink" title="1.备份与还原概述"></a>1.备份与还原概述</h2><p>​    数据库备份是指通过导出数据或者复制表文件的方式来制作数据库的副本。</p>
<p>​    在MySQL数据库中具体实现备份数据库的方法可以分为一下几种：</p>
<p>​    <strong>1.完全备份</strong></p>
<p>​    将数据库中的数据及所有对象全部备份。</p>
<p>​    <strong>2.表备份</strong></p>
<p>​    仅将一张或多张表中的数据进行备份，可以使用select into…outfile或backup table语句，只提取数据库中的数据，而不备份表的结构和定义。load data infile语句就是select into…outfile语句的反执行，能够将所备份的文件重新放回表中。</p>
<p>​    <strong>3.增量备份</strong></p>
<p>​    在某次完全备份的基础上，只备份其后数据的变化。可用于定期备份和自动恢复。</p>
<p>​    另外，通过备份和恢复数据库，也可以实现将数据库从一个服务器移动或复制到另一个服务器的目的。</p>
<h2 id="2-通过文件备份和还原"><a href="#2-通过文件备份和还原" class="headerlink" title="2.通过文件备份和还原"></a>2.通过文件备份和还原</h2><p>​    在复制数据库文件时，需要先停止MySQL数据库服务器。在停止前，需要先执行FLUSH TABLES语句将所有数据写入到数据文件的文本文件中。只适合MyISAM引擎</p>
<p>​    实现数据还原时还必须保证MySQL的主版本号是一致的。</p>
<h2 id="3-通过命令mysqldump备份还原"><a href="#3-通过命令mysqldump备份还原" class="headerlink" title="3.通过命令mysqldump备份还原"></a>3.通过命令mysqldump备份还原</h2><p>​    在MySQL安装目录下的bin子目录中，mysqldump程序和mysqlimport程序分别是两个常用的用于实现数据库备份和恢复的实用工具。</p>
<h3 id="3-1-备份"><a href="#3-1-备份" class="headerlink" title="3.1 备份"></a>3.1 备份</h3><p>​    <strong>1.使用mysqldump程序备份数据</strong></p>
<p>​    mysqldump程序可以备份数据库表的结构，还可以备份一个数据库，甚至整个数据库系统。</p>
<p>​    <strong>（1）备份表</strong></p>
<p>​    <code>mysqldump [options] database [tables] &gt; filename</code></p>
<p>​    <strong>（2）备份数据库</strong></p>
<p>​    <code>mysqldump [options] -databases [options] db1 [db2...] &gt; filename</code></p>
<p>​    <strong>（3）备份整个数据库系统</strong></p>
<p>​    <code>mysqldump [options] -all -databases [options] &gt;filename</code></p>
<p>​    可以在mysqldump命令中使用“–tab=”选项来分开数据和创建表的sql语句。“–tab=”会在选项中“=”后面指定的目录中，分别创建存储数据内容的txt文件和包含创建表结构的sql文件。另外，该选项不能与–all -databases或-databases同时使用，并且mysqldump必须运行在服务器的主机上。</p>
<h3 id="3-2-还原"><a href="#3-2-还原" class="headerlink" title="3.2 还原"></a>3.2 还原</h3><p>​    <strong>1.使用MySQL命令将mysqldump程序备份的文件中的全部sql语句还原到MySQL中</strong></p>
<p>​    <code>mysql -uroot -p123456 mysql_test &lt; mysql_test.sql;</code></p>
<p>​    <strong>2.使用mysqlimport程序恢复数据</strong></p>
<p>​    <code>mysqlimport [options] database textfile...;</code></p>
<h2 id="4-表的导入和导出"><a href="#4-表的导入和导出" class="headerlink" title="4.表的导入和导出"></a>4.表的导入和导出</h2><p>​    在MySQL中，可以使用select into…outfile语句把表数据导出到一个文本文件中进行备份，并可使用load data…infile语句恢复先前备份的数据。</p>
<p>​    这种方法有一点不足，就是只能导出或导入数据的内容，而不包括表的结构，若表的结构文件损坏，则必须先设法恢复原来表的结构。</p>
<p>​    <strong>1.导出备份语句select into…outfile</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">into outfile &apos;filename&apos; [character set charset_name]</span><br><span class="line">export_options | into dumpfile &apos;filename&apos;</span><br></pre></td></tr></table></figure>
<p>​    其中，export_options的格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[fields</span><br><span class="line">[terminated by &apos;string&apos;]</span><br><span class="line">[[optionally] enclosed by &apos;char&apos;]</span><br><span class="line">[escaped by &apos;char&apos;]</span><br><span class="line">]</span><br><span class="line">[linesterminated by &apos;string&apos;]</span><br></pre></td></tr></table></figure>
<p>​    这个语句的作用是将表中select语句选中的所有数据行写入到一个文件中，file_name指定数据备份文件的名称。</p>
<p>​    <strong>2.load data…infile语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">load data [low_priority|concurrent] [local] infile &apos;file_name.txt&apos;</span><br><span class="line">[replace|ignore]</span><br><span class="line">into table tbl_name</span><br><span class="line">[fields</span><br><span class="line">[terminated by &apos;string&apos;]</span><br><span class="line">[[optionally] enclosed by &apos;char&apos;]</span><br><span class="line">[escaped by &apos;char&apos;]</span><br><span class="line">]</span><br><span class="line">[lines</span><br><span class="line">[starting by &apos;string&apos;]</span><br><span class="line">[terminated by &apos;string&apos;]</span><br><span class="line">]</span><br><span class="line">[ignore number lines]</span><br><span class="line">[(col_name or user_var,...)]</span><br><span class="line">[set col_name=expr,...]</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/24/MySQL权限管理/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/24/MySQL权限管理/" itemprop="url">MySQL权限管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-24T19:42:50+08:00">
                2019-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/24/MySQL权限管理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/24/MySQL权限管理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-访问控制"><a href="#1-访问控制" class="headerlink" title="1.访问控制"></a>1.访问控制</h2><p>​    MySQL提供了访问控制，以此来确保MySQL服务器的安全访问，即用户应该对他们需要的数据具有<strong>适当</strong>的访问权，既不能多，也不能少。</p>
<h2 id="2-权限表"><a href="#2-权限表" class="headerlink" title="2.权限表"></a>2.权限表</h2><p>​    常用的权限表有：user、db、table_priv、columns_priv、column_priv和procs_priv。</p>
<h3 id="2-1-user表"><a href="#2-1-user表" class="headerlink" title="2.1 user表"></a>2.1 user表</h3><p>​    user列主要分为4部分：用户列、权限列、安全列和资源控制列。</p>
<p>​    当用户进行连接时，权限表的存取过程有以下两个阶段：</p>
<p>​    1）从user表中的host、user和password三个字段中判断连接的ip、用户名和密码是否存在于表中，若存在则通过身份验证。</p>
<p>​    2）若通过身份验证，按照以下权限的顺序得到数据库权限：user、db、table_priv、columns_priv。这几个表的权限依次递减，全局权限覆盖局部权限。</p>
<p>​    <strong>1.用户字段</strong></p>
<p>​    host、user、password</p>
<p>​    <strong>2.权限字段</strong></p>
<p>​    user表包含几十个与权限有关以priv结尾的字段，这些权限字段决定了用户的权限，它们的值只有y或n，默认为n，可以使用grant语句为用户赋予一些权限。</p>
<p>​    <strong>3.安全字段</strong></p>
<p>​    安全列只有六个字段，其中两个是ssl相关的：ssl_type和ssl_cipher，两个是x509相关的：x509_issuer和x509_subject，另外两个是授权插件相关的。</p>
<p>​    ssl用于加密；x509标准可用于标识用户；plugin字段标识可以用于验证用户身份的插件。</p>
<p>​    <strong>4.资源控制列</strong></p>
<p>​    资源控制列的字段用来限制用户使用的资源：</p>
<p>​    max_questions:用户每小时允许执行的查询操作次数</p>
<p>​    max_updates:用户每小时允许执行的更新操作次数</p>
<p>​    max_connections:用户每小时允许执行的连接操作次数</p>
<p>​    max_user_connections:单个用户可以同时具有的连接数</p>
<p>​    这些字段的默认值为0，表示没有限制。</p>
<h3 id="2-2-db表和host表"><a href="#2-2-db表和host表" class="headerlink" title="2.2 db表和host表"></a>2.2 db表和host表</h3><p>​    db表中存储了用户对某个数据库的操作权限，决定用户能从哪个主机存取哪个数据库；host表中存储了某个主机对数据库的操作权限，配合db表对给定主机上数据库级操作权限做更细致的控制。</p>
<p>​    这两个权限表不受grant和revoke语句的影响。字段可大致可以分为两类：用户列和权限列。</p>
<p>​    <strong>1.用户列</strong></p>
<p>​    db表：host、db和user；host表：host和db。</p>
<p>​    host表是db表的扩展。如果db表中找不到host字段的值，就需要到host表中去寻找。</p>
<p>​    <strong>2.权限列</strong></p>
<p>​    db表和host表的权限列大致相同。</p>
<p>​    user表中的权限是针对所有数据库的。用户先根据user表的内容获取权限，然后再根据db表的内容获取权限。</p>
<h3 id="2-3-table-priv表"><a href="#2-3-table-priv表" class="headerlink" title="2.3 table_priv表"></a>2.3 table_priv表</h3><p>​    table_priv表可以对单个表进行权限设置，这里指定的权限适用于一个表的所有列。</p>
<p>​    table_priv表有八个字段：host、db、user、table_name、grantor、timestamp、table_priv和column_priv。</p>
<ul>
<li>字段说明如下：<ul>
<li>table_priv字段表示对表进行操作的权限，包括select、insert、update、delete、create、drop、grant、references、index和alter。</li>
<li>column_priv字段表示对表中的列进行操作的权限，包括select、insert、update和references。</li>
</ul>
</li>
</ul>
<h3 id="2-4-columns-priv表"><a href="#2-4-columns-priv表" class="headerlink" title="2.4 columns_priv表"></a>2.4 columns_priv表</h3><p>​    columns_priv可以对表中的某一列进行权限设置。</p>
<p>​    columns_priv表只有七个字段：host、db、user、table_name、column_name、timestamp和column_priv。</p>
<p>​    MySQL中权限的分配是按照user表、db表、tables_priv表和columns_priv表的顺序进行分配的。    </p>
<h3 id="2-5-procs-priv表"><a href="#2-5-procs-priv表" class="headerlink" title="2.5 procs_priv表"></a>2.5 procs_priv表</h3><p>​    procs_priv表可以对存储过程和存储函数进行权限设置。</p>
<p>​    procs_priv表包含八个字段：host、db、user、routine_name、routine_type、grantor、timestamp和proc_priv。</p>
<h2 id="3-用户管理"><a href="#3-用户管理" class="headerlink" title="3.用户管理"></a>3.用户管理</h2><p>​    MySQL用户账号和信息存储在名为<strong>mysql</strong>的数据库中。数据库中有个user表，包含所有用户的账号。</p>
<h3 id="3-1-添加用户"><a href="#3-1-添加用户" class="headerlink" title="3.1 添加用户"></a>3.1 添加用户</h3><p>​    <strong>1.使用create use创建用户账号</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create user identified by [password] &apos;password&apos;</span><br></pre></td></tr></table></figure>
<p>​    user：指定创建用户账号，格式为`user_name‘@’host_name’。如果在创建的过程中只给出了用户名，而没指定主机名，则主机名默认为‘%’，表示一组主机。</p>
<p>​    identified by子句：用于指定用户账号对应的口令。</p>
<p>​    可选项password：用于指定散列口令。知道password()函数返回给密码的散列值。</p>
<p>​    create user语句的使用说明如下：</p>
<p>​    1）要使用create user语句，必须拥有mysql数据库的insert权限或全局create user权限。</p>
<p>​    2）如果两个用户具有相同的用户名和不同的主机名，MySQL将视为不同的用户。</p>
<p>​    3）新创建的用户拥有的权限很少，只允许进行不需要权限的操作，不可使用use database语句。</p>
<p>​    <strong>2.使用insert语句新建普通用户</strong></p>
<p>​    将用户信息直接插入mysql.user表中，插入时，至少要插入以下六个字段的值：host、user、password、ssl_cipher、x509_issuer、x509_subject。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into mysql.user(host,user,password,ssl_cipher,x509_issuer,x509_subject)</span><br><span class="line">values(&apos;localhost&apos;,&apos;fang&apos;,password(123),&apos;&apos;,&apos;&apos;,&apos;&apos;);</span><br></pre></td></tr></table></figure>
<p>​    执行完毕后，要使用<code>flush privileges;</code>命令来使用户生效，需要reload权限。</p>
<p>​    <strong>3.使用grant语句</strong></p>
<p>​    可以使用grant语句来创建新的用户，在创建用户时可以为用户授权。</p>
<h3 id="3-2-查看用户"><a href="#3-2-查看用户" class="headerlink" title="3.2 查看用户"></a>3.2 查看用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from mysql.user</span><br><span class="line">where host=&apos;host_name&apos; and user=&apos;user_name&apos;;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-修改用户账号"><a href="#3-3-修改用户账号" class="headerlink" title="3.3 修改用户账号"></a>3.3 修改用户账号</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename user old_user to new_user</span><br></pre></td></tr></table></figure>
<h3 id="3-4-修改用户口令"><a href="#3-4-修改用户口令" class="headerlink" title="3.4 修改用户口令"></a>3.4 修改用户口令</h3><pre><code>**1）mysqladmin命令**
</code></pre><p>​    <code>mysqladmin -u username -p password</code></p>
<p>​    <strong>2）set语句</strong></p>
<p>​    <code>set password [for &#39;username&#39;@&#39;hostname&#39;]=password(&#39;new_password&#39;);</code></p>
<p>​    如果不加for ‘username‘@’hostname’，则修改当前用户密码。</p>
<p>​    <strong>3）修改mysql.user表，需要root权限</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update mysql.user</span><br><span class="line">set password=password(&apos;new_password&apos;)</span><br><span class="line">where user=&apos;user_name&apos; and host=&apos;host_name&apos;;</span><br></pre></td></tr></table></figure>
<p>​    修改后，还是需要flush命令重新加载权限。</p>
<p>​    使用set password、insert或update指定账户的密码时，必须用password()函数进行加密，唯一特例是密码为空。之所以要加密，是因为当用户登录服务器时，密码值会被加密后再与user表中相应的密码比较。</p>
<h3 id="3-5-删除用户"><a href="#3-5-删除用户" class="headerlink" title="3.5 删除用户"></a>3.5 删除用户</h3><p>​    <strong>1.drop user</strong></p>
<p>​    需有drop user权限，<code>drop user user</code>，user参数由用户名和主机名组成。</p>
<p>​    <strong>2.使用delete语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from mysql.user where user=&apos;user_name&apos; and host=&apos;host_name&apos;;</span><br></pre></td></tr></table></figure>
<p>​    显示操作成功后，还要用flush命令重新装载权限。</p>
<h2 id="4-账户权限管理"><a href="#4-账户权限管理" class="headerlink" title="4.账户权限管理"></a>4.账户权限管理</h2><h3 id="4-1-权限授予"><a href="#4-1-权限授予" class="headerlink" title="4.1 权限授予"></a>4.1 权限授予</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grant</span><br><span class="line">priv_type[(column_list)] [,priv_type[(column_list)]]...</span><br><span class="line">on [object_type] priv_level</span><br><span class="line">to user_specification[,user_specification]...</span><br><span class="line">[with with_option...]</span><br></pre></td></tr></table></figure>
<p>​    语法说明如下：</p>
<p>​    1）priv_type：指定权限的名称，如select、insert等。</p>
<p>​    2）选项column_list：指定权限要授予哪些列。</p>
<p>​    3）on子句：指定权限授予的对象和级别，如数据库名或表名。</p>
<p>​    4）可选项object_type：指定权限授予的对象类型，包括表、函数和存储过程。</p>
<p>​    5）pri_level：指定权限的级别。有列权限、表权限、数据库权限和用户权限。</p>
<p>​    6）to字句：用来设定用户的口令，以及指定被授予权限的用户user。若在to子句中给系统存在的用户指定口令，则新密码将覆盖原密码；如果权限被授予给一个不存在的用户，MySQL会自动执行一条create user语句来创建这个用户，但同时必须为该用户指定口令。</p>
<p>​    7）with子句：实现权限的转移或限制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grant all on student </span><br><span class="line">to &apos;fang&apos;@&apos;localhost&apos; identified by &apos;123&apos;,</span><br><span class="line">&apos;lin&apos;@&apos;localhost&apos; identified by &apos;123&apos;;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-权限的转移和限制"><a href="#4-2-权限的转移和限制" class="headerlink" title="4.2 权限的转移和限制"></a>4.2 权限的转移和限制</h3><p>​    <strong>1.转移权限</strong></p>
<p>​    将with子句指定为with grant option，表示to子句中的所有用户都具有把自己所拥有的权限授予其他用户的权利。</p>
<p>​    <strong>2.限制权限</strong></p>
<p>​    如果with子句中 with关键字后面紧跟的是<em>max_queries_per_hour count</em>、<em>max_updates_per_hour count</em>、<em>max_connections_per_hour count</em>、<em>max_user_connections count</em>或<em>max_queries_per_hour count</em>中的某一项，则该语句可用于限制权限。</p>
<h3 id="4-3-权限的撤销"><a href="#4-3-权限的撤销" class="headerlink" title="4.3 权限的撤销"></a>4.3 权限的撤销</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">第一种：回收某些特定的权限</span><br><span class="line">revoke priv_type[(column_list)] [,priv_type[(column_list)]]...</span><br><span class="line">on [object_type] priv_level</span><br><span class="line">from user[,user]...</span><br><span class="line">第二种：回收特定用户的所有权限</span><br><span class="line">revoke all privileges,grant option</span><br><span class="line">from user[,user]...</span><br></pre></td></tr></table></figure>
<p>​    要使用revoke语句，必须拥有mysql数据库的全局create user权限或update权限。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/23/MySQL索引/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/23/MySQL索引/" itemprop="url">MySQL索引</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-23T14:42:50+08:00">
                2019-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/23/MySQL索引/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/23/MySQL索引/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-索引"><a href="#1-索引" class="headerlink" title="1.索引"></a>1.索引</h2><h3 id="1-1-索引概述"><a href="#1-1-索引概述" class="headerlink" title="1.1 索引概述"></a>1.1 索引概述</h3><p>​    索引与书的目录非常相似，由数据表中的一列或多列组合而成，创建索引的目的是为了优化数据库的查询速度，索引是提高性能最常用的工具。</p>
<p>​    索引有两种存储类型：B型树索引和哈希索引。其中B型树为系统默认索引存储类型。</p>
<h3 id="1-2-索引的作用"><a href="#1-2-索引的作用" class="headerlink" title="1.2 索引的作用"></a>1.2 索引的作用</h3><ul>
<li>优点：<ul>
<li>通过创建唯一性索引，可以保证数据库表每一行数据的唯一性。</li>
<li>大大加快数据的检索速度</li>
<li>加速表与表之间的连接</li>
<li>显著减少分组和排序子句的执行时间。</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>创建索引和维护索引耗费时间</li>
<li>索引需要占物理空间。</li>
<li>当对表中的数据进行添加、删除和修改时，索引也要动态地维护，这样就降低了数据的维护速度。</li>
</ul>
<p><strong>索引的特征</strong></p>
</li>
</ul>
<p>​    <strong>唯一性索引</strong>和<strong>复合索引</strong>。</p>
<p>​    唯一性索引保证在索引列中的全部数据是唯一的，不会包含冗余数据。如果表中已经有一个主键约束或者唯一性键约束，那么当创建表或者修改表时，MySQL会自动创建一个唯一性索引。然而，如果必须保证唯一性的话，那么应该创建主键约束或者唯一性键约束，而不是创建一个唯一性索引。</p>
<p>​    复合索引就是一个索引创建在两个列或者多个列上。最多可把16个列合并；所有列必须来自同一个表中；列的排列顺序是很重要的。</p>
<h3 id="1-3-MySQL索引的分类"><a href="#1-3-MySQL索引的分类" class="headerlink" title="1.3 MySQL索引的分类"></a>1.3 MySQL索引的分类</h3><p>​    普通索引、唯一性索引、全文索引、单列索引、多列索引和空间索引。</p>
<h4 id="​-1-普通索引"><a href="#​-1-普通索引" class="headerlink" title="​    1.普通索引"></a>​    1.普通索引</h4><p>​        不附加任何限制条件。</p>
<h4 id="​-2-唯一性索引"><a href="#​-2-唯一性索引" class="headerlink" title="​    2.唯一性索引"></a>​    2.唯一性索引</h4><p>​        使用UNIQUE参数可以设置索引为唯一性索引。在创建唯一性索引时，限制该索引的值必须是唯一的。主键就是一种特殊的唯一性索引。</p>
<h4 id="​-3-全文索引"><a href="#​-3-全文索引" class="headerlink" title="​    3.全文索引"></a>​    3.全文索引</h4><p>​        使用FULLTEXT参数可以可以设置索引为全文索引。全文索引只能创建在CHAR、VARCHAR或TEXT类型的字段上。查询数据量比较大的字符串类型的字段时，使用全文索引可以提高查询速度。</p>
<h4 id="​-4-单列索引"><a href="#​-4-单列索引" class="headerlink" title="​    4.单列索引"></a>​    4.单列索引</h4><p>​        在表中的单个字段中创建索引。</p>
<h4 id="​-5-多列索引"><a href="#​-5-多列索引" class="headerlink" title="​    5.多列索引"></a>​    5.多列索引</h4><p>​        在表中的多个字段中创建索引。但是，只有查询条件中使用了这些字段中的第一个字段时，索引才会被使用。</p>
<h4 id="​-6-空间索引"><a href="#​-6-空间索引" class="headerlink" title="​    6.空间索引"></a>​    6.空间索引</h4><p>​        使用SPATIAL参数可以设置索引为空间索引。空间索引只能建立在空间数据类型上，这样可以提高系统获取空间数据的效率。</p>
<h2 id="2-索引的管理"><a href="#2-索引的管理" class="headerlink" title="2.索引的管理"></a>2.索引的管理</h2><h3 id="2-1-创建索引"><a href="#2-1-创建索引" class="headerlink" title="2.1 创建索引"></a>2.1 创建索引</h3><h5 id="直接创建"><a href="#直接创建" class="headerlink" title="直接创建"></a><strong>直接创建</strong></h5><p>​    1.在创建表的时候创建索引。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table table_name(</span><br><span class="line">	属性名 数据类型，[完整性约束]</span><br><span class="line">	...</span><br><span class="line">	index | key [索引名](属性名[(长度)][asc|desc]))；</span><br></pre></td></tr></table></figure>
<p>​    2.在已存在的表上创建索引。</p>
<p><code>create index 索引名 ON 表名(属性名[(长度)][asc|desc\])；</code></p>
<p>​    3.使用alter table语句来创建索引。</p>
<p><code>alter table table_name add index|key \[索引名](属性名[(长度)][asc|desc\]);</code></p>
<h5 id="间接创建"><a href="#间接创建" class="headerlink" title="间接创建"></a>间接创建</h5><p>​    在表中定义主键约束或者唯一性键约束时，同时也创建了索引。主键约束或者唯一性键约束创建的索引的优先级高于使用CREATE INDEX语句创建的索引。</p>
<h3 id="2-2-查看索引"><a href="#2-2-查看索引" class="headerlink" title="2.2 查看索引"></a>2.2 查看索引</h3><p><code>SHOW INDEX FROM table_name [FROM db_name]</code></p>
<h3 id="2-3-删除索引"><a href="#2-3-删除索引" class="headerlink" title="2.3 删除索引"></a>2.3 删除索引</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drop index index_name on table_name;</span><br><span class="line">alter table table_name drop index index_name;</span><br><span class="line">alter table table_name drop primary key;</span><br></pre></td></tr></table></figure>
<p>​    一张表只可能有一个PRIMARY KEY索引，因此不需要指定索引名。</p>
<p>​    如果从表中删除某列，索引会受到影响。如果删除组成索引的所有列，则整个索引会被删除。</p>
<h2 id="3-索引设计原则和注意事项"><a href="#3-索引设计原则和注意事项" class="headerlink" title="3.索引设计原则和注意事项"></a>3.索引设计原则和注意事项</h2><h3 id="3-1-设计原则"><a href="#3-1-设计原则" class="headerlink" title="3.1 设计原则"></a>3.1 设计原则</h3><p>（1）选择唯一性索引</p>
<p>（2）为经常需要排序、分组和联合操作的字段建立索引</p>
<p>（3）为常作为查询条件的字段建立索引</p>
<p>（4）限制索引的数目</p>
<p>（5）尽量使用数据量少的索引</p>
<p>（6）尽量使用前缀来索引</p>
<p>（7）删除不再使用或者很少使用的索引</p>
<h3 id="3-2-合理使用索引注意事项"><a href="#3-2-合理使用索引注意事项" class="headerlink" title="3.2 合理使用索引注意事项"></a>3.2 合理使用索引注意事项</h3><p>应该在如下这些列上创建索引：</p>
<p>1）经常需要搜索的列</p>
<p>2）作为主键的列</p>
<p>3）用在连接的列</p>
<p>4）需要根据范围进行搜索的列</p>
<p>5）需要排序的列</p>
<p>6）使用在WHERE子句中的列</p>
<h3 id="3-3-不合理使用索引注意事项"><a href="#3-3-不合理使用索引注意事项" class="headerlink" title="3.3 不合理使用索引注意事项"></a>3.3 不合理使用索引注意事项</h3><p>不应该创建索引的列：</p>
<p>1）查询中很少使用的列</p>
<p>2）只有很少数据取值的列</p>
<p>3）定义为text、image和bit数据类型的列</p>
<p>4）当修改性能远远大于检索性能时，不应该创建索引</p>
<p>​    </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/23/MySQL触发器与事件调度器/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/23/MySQL触发器与事件调度器/" itemprop="url">MySQL触发器与事件调度器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-23T12:42:50+08:00">
                2019-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/23/MySQL触发器与事件调度器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/23/MySQL触发器与事件调度器/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-触发器"><a href="#1-触发器" class="headerlink" title="1.触发器"></a>1.触发器</h2><h3 id="1-1-触发器的概念"><a href="#1-1-触发器的概念" class="headerlink" title="1.1 触发器的概念"></a>1.1 触发器的概念</h3><p>​    触发器是一种特殊的存储过程，它在插入、删除或修改特定表中的数据时触发执行。</p>
<p>​    数据库触发器有以下作用：</p>
<p>​    <strong>1.安全性：</strong>可以基于数据库的值使用户具有操作数据库的某种权利。可以基于时间限制用户的操作。可以基于数据库中的数据限制用户的操作。</p>
<p>​    <strong>2.审计：</strong>可以跟踪用户对数据库的操作。审计用户操作数据库的语句。</p>
<p>​    <strong>3.实现复杂的数据完整性规则：</strong>实现非标准的数据完整性检查和约束。触发器可产生比规则更为复杂的限制。</p>
<p>​    <strong>4.实现复杂的非标准的数据库相关完整性规则：</strong>触发器可以对数据库中相关的表进行连环更新。</p>
<h3 id="1-2-创建使用触发器"><a href="#1-2-创建使用触发器" class="headerlink" title="1.2 创建使用触发器"></a>1.2 创建使用触发器</h3><p>​    触发程序是与表有关的命名数据库对象，当表上出现特定事件时，将激活该对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create trigger trigger_name trigger_time trigger_event</span><br><span class="line">on table_name for each row trigger_stmt</span><br></pre></td></tr></table></figure>
<p>​    table_name必须引用永久性表。</p>
<p>​    trigger_time是触发程序的发动时间。可以是before或after。</p>
<p>​    trigger_event指明了激活触发程序的语句的类型。可以是下述值之一：</p>
<p>​    1）insert：将新行插入表时。通过insert、load data和replace语句。</p>
<p>​    2）update：更改某一行时。通过update语句。</p>
<p>​    3）delete：从表中删除某一行时。通过delete和replace语句。</p>
<p>​    <strong>注意：</strong>trigger_event与sql语句并不相同。</p>
<p>​    对于具有相同触发器动作时间和事件的给定表，不能有两个触发程序。例，对于某一表，不能同时有两个before update触发程序。</p>
<p>​    trigger_stmt是需要执行的语句。多个语句可以使用begin…end结构。</p>
<p>​    例：创建一个表tb。在表上创建触发器，每次插入时，将用户变量count的值加1。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">create table tb(a int);</span><br><span class="line">set @count=0;</span><br><span class="line">create trigger tb_insert after insert on tb for each row</span><br><span class="line">set @count = @count+1;</span><br><span class="line">insert into tb values(11);</span><br><span class="line">select @count;</span><br><span class="line">+--------+</span><br><span class="line">| @count |</span><br><span class="line">+--------+</span><br><span class="line">|      1 |</span><br><span class="line">+--------+</span><br><span class="line">insert into tb values(21);</span><br><span class="line">select @count;</span><br><span class="line">+--------+</span><br><span class="line">| @count |</span><br><span class="line">+--------+</span><br><span class="line">|      2 |</span><br><span class="line">+--------+</span><br></pre></td></tr></table></figure>
<p><strong>注意事项：</strong></p>
<p>​    触发程序不能调用将数据返回客户端的存储程序，也不能采用CALL语句的动态SQL（允许存储程序通过函数将数据返回触发程序）。</p>
<p>​    触发程序不能使用以显式或隐式方式开始或结束事务的语句，如START TRANSACTION、COMMIT或ROLLBACK。使用OLD和NEW关键字能够访问受触发程序影响的行中的列（OLD和NEW不分大小写）。</p>
<p>​    在INSERT触发程序中，只能使用NEW。在DELETE触发程序中，只能使用OLD。在UPDATE触发程序中，NEW和OLD都可以使用。</p>
<p>​    在BEFORE触发程序中，如果具有UPDATE权限，可使用“SET NEW.col_name=value”更改它的值。AUTO_INCREMENT列的NEW值为0，不是实际插入新纪录时将自动生成的序列号。</p>
<p>​    通过BEGIN…END结构，能够定义执行多条语句的触发程序。还能使用存储子程序中运行的其他语法。</p>
<h3 id="1-3-查看触发器"><a href="#1-3-查看触发器" class="headerlink" title="1.3 查看触发器"></a>1.3 查看触发器</h3><p>​    查看所有触发器信息：<code>show triggers；</code></p>
<p>​    查询指定触发器：<code>select * from information_schema.triggers where trigger_name=&#39;tb_insert&#39;;</code></p>
<h3 id="1-4-删除触发器"><a href="#1-4-删除触发器" class="headerlink" title="1.4 删除触发器"></a>1.4 删除触发器</h3><p>​    <code>drop trigger [schema_name.]trigger_name;</code></p>
<p>​    如果忽略了schema_name，将从当前数据库中删除触发程序。</p>
<h2 id="2-事件"><a href="#2-事件" class="headerlink" title="2.事件"></a>2.事件</h2><h3 id="2-1-事件的概念"><a href="#2-1-事件的概念" class="headerlink" title="2.1 事件的概念"></a>2.1 事件的概念</h3><p>​    自MySQL 5.1.0起，增加了事件调度器，可以用作定时执行某些特定任务来取代原先只能由操作系统的计划任务来执行的工作。MySQL中的事件调度器可精确到每秒执行一个任务，而操作系统的计划任务只能精确到分钟。对于一些对数据实时性要求比较高的应用就很适合。</p>
<p>​    事件调度器是基于特定时间周期触发来执行某些任务，而触发器是基于某个表所产生的事件触发的。</p>
<h3 id="2-2-创建事件"><a href="#2-2-创建事件" class="headerlink" title="2.2 创建事件"></a>2.2 创建事件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create event event_name</span><br><span class="line">on schedule schedule</span><br><span class="line">[on completion [not] preserve]</span><br><span class="line">[enable|disable|disable on slave]</span><br><span class="line">[comment &apos;comment&apos;]</span><br><span class="line">do event_body;</span><br></pre></td></tr></table></figure>
<p>​    on schedule schedule:定义执行的时间和时间间隔</p>
<p>​    on completion [not] preserve：定义时间是一次执行还是永久执行，默认为一次执行。</p>
<p>​    enable|disable|disable on slave：定义事件创建后是开启还是关闭。</p>
<p>例：创建一个立即启动的事件，创建后查看tb表的信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create event example</span><br><span class="line">on schedule at now()</span><br><span class="line">do insert into tb values(33);</span><br><span class="line"></span><br><span class="line">select * from tb;</span><br></pre></td></tr></table></figure>
<p>​    在使用事件调度器之前，必须确保event_scheduler已开启，可执行<code>global event_scheduler = 1;</code></p>
<p>例：创建一个五秒后启动的事件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create event example</span><br><span class="line">on schedule at current_timestamp + interval 5 second</span><br><span class="line">do insert into tb values(44);</span><br><span class="line"></span><br><span class="line">select * from tb;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-修改事件"><a href="#2-3-修改事件" class="headerlink" title="2.3 修改事件"></a>2.3 修改事件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter event event_name [on schedule schedule]</span><br><span class="line">[rename to new_event_name] [on completion [not] preserve]</span><br><span class="line">[comment &apos;comment&apos;] [enable|disable] [do sql_stmt]</span><br></pre></td></tr></table></figure>
<p>​    临时关闭事件<code>alter event event_name disable</code>，那么当重新启动MySQL服务器后，该event_name将被删除。</p>
<h3 id="2-4-删除事件"><a href="#2-4-删除事件" class="headerlink" title="2.4 删除事件"></a>2.4 删除事件</h3><p>​    <code>drop event [if exists] event_name；</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/22/MySQL存储过程和函数/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/22/MySQL存储过程和函数/" itemprop="url">MySQL存储过程和函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-22T12:42:50+08:00">
                2019-01-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/22/MySQL存储过程和函数/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/22/MySQL存储过程和函数/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-存储过程与函数简介"><a href="#1-存储过程与函数简介" class="headerlink" title="1.存储过程与函数简介"></a>1.存储过程与函数简介</h2><h3 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念"></a>1.1 概念</h3><p>​    <strong>1.存储过程概述</strong></p>
<p>​    存储过程是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给定参数来调用执行它。</p>
<p>​    一个存储过程是一个可编程的函数，它在数据库中创建并保存。数据库中的存储过程可以看作对编程中面向对象方法的模拟。</p>
<p>​    <strong>2.存储过程的优点</strong></p>
<p>​    1）存储过程增强了SQL语言的功能和灵活性。存储过程可以用流控制语言编写。</p>
<p>​    2）存储过程允许标准组件是编程。存储过程创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。</p>
<p>​    3）存储过程能实现比较快的执行速度。因为存储过程是预编译的。在首次运行一个存储过程时查询优化器对其进行分析优化，并给出最终被存储在系统表中的执行计划。</p>
<p>​    4）存储过程能减少网络流量。网络中传送的只是调用语句。</p>
<p>​    5）存储过程可被作为一种安全机制来充分利用。</p>
<p>​    MySQL在5.0以前并不支持存储过程。</p>
<h3 id="1-2-存储过程和函数区别"><a href="#1-2-存储过程和函数区别" class="headerlink" title="1.2 存储过程和函数区别"></a>1.2 存储过程和函数区别</h3><p>·    1）一般来说，存储过程实现的功能要复制一点，而函数实现的功能针对性比较强。存储过程功能强大，可以执行包括修改表等一系列数据库操作；用户定义函数不能用于执行一组修改全局数据库状态的操作。</p>
<p>​    2）存储过程可以返回参数，而函数只能返回值或者表对象。函数只能返回一个变量，而存储过程可以返回多个变量。存储过程的参数可以有in、out、inout三种类型，而函数只能有in类型。存储过程声明时不需要返回类型，而函数声明时需要描述返回类型，且函数体必须包含return。</p>
<p>​    3）存储过程可以使用非确定函数。</p>
<p>​    4）存储过程通常是作为一个独立的部分来执行（execute），而函数可以作为查询语句的一个部分来调用（select调用）。SQL语句不可以用存储过程，而可使用函数。</p>
<h2 id="2-存储过程与函数操作"><a href="#2-存储过程与函数操作" class="headerlink" title="2.存储过程与函数操作"></a>2.存储过程与函数操作</h2><h3 id="2-1-创建和使用存储过程或函数"><a href="#2-1-创建和使用存储过程或函数" class="headerlink" title="2.1 创建和使用存储过程或函数"></a>2.1 创建和使用存储过程或函数</h3><h4 id="2-1-1-存储过程"><a href="#2-1-1-存储过程" class="headerlink" title="2.1.1 存储过程"></a>2.1.1 存储过程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create procedure sp_name([proc_parameter[,..]])</span><br><span class="line">[characteristic..] routine_body</span><br></pre></td></tr></table></figure>
<p>其中，sp_name是存储过程的名称；proc_parameter表示存储过程的参数列表；characteristic指定存储过程的特性；routine_body是SQL代码的内容，可以用begin…end来标志SQL代码的开始与结束。</p>
<p>proc_parameter中的每个参数由三部分组成：[in|out|inout] param_name type</p>
<p>characteristic参数具有多个取值：</p>
<ul>
<li><p>languageSQL：说明routine_body部分是由SQL语句组成的，默认。</p>
</li>
<li><p>[not] deterministic：指明存储过程的执行结果是否是确定的。默认是非确定的。</p>
</li>
<li><p>{containsSQL|no SQL|reads SQL data|modifies SQL data}：指明子程序使用SQL语句的限制。默认为containsSQL。</p>
</li>
<li><p>SQL security {definer|invoker}：指明谁有权限来执行。默认为definer。</p>
</li>
<li><p>comment ’string‘：注释信息。</p>
<p>调用存储过程的语法格式：<code>call sp_name([parameter[,..]])</code></p>
</li>
</ul>
<h4 id="2-1-2-创建存储函数"><a href="#2-1-2-创建存储函数" class="headerlink" title="2.1.2 创建存储函数"></a>2.1.2 创建存储函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create function sp_name([func_parameter[,..]])</span><br><span class="line">returns type</span><br><span class="line">[characteristic..] routine_body</span><br></pre></td></tr></table></figure>
<p>func_parameter可以由多个参数组成，其中每个参数由两部分组成：param_name type</p>
<p>​    调用存储函数的语法格式：<code>select sp_name([func_parameter[,...]])</code></p>
<p>​    存储函数的使用方法和MySQL内部函数的使用方法是一样的。</p>
<h4 id="2-1-3-delimiter命令"><a href="#2-1-3-delimiter命令" class="headerlink" title="2.1.3 delimiter命令"></a>2.1.3 delimiter命令</h4><p>​    指定语句结束标志，MySQL默认为分号“：”。</p>
<p>​    存储过程的简单例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter ##</span><br><span class="line">create procedure getNameBySno(in xh char(10),out name char(20))</span><br><span class="line">begin</span><br><span class="line">select sname into name from student where sno=xh;</span><br><span class="line">end ##</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>​    存储函数的简单例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delimiter ##</span><br><span class="line">create function numOfStu()</span><br><span class="line">returns integer</span><br><span class="line">begin</span><br><span class="line">return(select count(*) from student);</span><br><span class="line">end ##</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<p>​    return子句中包含select语句时，select语句的返回结果只能是一行且只有一列值。</p>
<h3 id="2-2-变量"><a href="#2-2-变量" class="headerlink" title="2.2 变量"></a>2.2 变量</h3><p><strong>1.declare语句申明局部变量</strong></p>
<p>declare语句申明局部的变量只适用于begin…end程序段中。</p>
<p>语法格式：<code>declare var_name1[,var_name2]... type [default value]</code></p>
<p><strong>2.用set语句给变量赋值</strong></p>
<p>格式：<code>set var_name=exper[,var_name=exper]</code></p>
<p>set可以直接声明用户变量，不需要声明类型，declare必须指定类型。set位置任意，declare必须在复合语句的开头。declare定义的变量的作用范围是begin…end块内。set定义的变量在定义时，变量名前使用@符号修饰，如set @var=2。</p>
<p><strong>3.使用select语句给变量赋值</strong></p>
<p>语法格式：<code>select col_name[,..] into var_name[,..] table_expr</code></p>
<p>例：定义一个存储过程，作业是输出两个字符串拼接后的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create procedure myConcat() select CONCAT(@str1,@str2);</span><br><span class="line">set @str1=&apos;ab&apos;,@str2=&apos;cd&apos;;</span><br><span class="line">call myConcat();</span><br></pre></td></tr></table></figure>
<h3 id="2-3-定义条件和处理"><a href="#2-3-定义条件和处理" class="headerlink" title="2.3 定义条件和处理"></a>2.3 定义条件和处理</h3><p><strong>1.定义条件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">declare condition_name condition for condition_value</span><br><span class="line">condition_value:SQLstate[value] SQLstate_value|MySQL_error_code</span><br></pre></td></tr></table></figure>
<p>​    condition_value是用来实现设置条件的类型，SQLstate_value和MySQL_error_code用来设置条件的错误。</p>
<p><strong>2.定义处理程序</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">declare handler_type handler for condition_value[,..] sp_statement</span><br><span class="line">handler_type:continue|exit|undo</span><br><span class="line">condition_value:SQLstate[value] SQLstate_value|condition_name|SQLwarning|not found|SQLexception|MySQL_error_code</span><br></pre></td></tr></table></figure>
<p>​    handler_type表示错误的处理方式。</p>
<h3 id="2-4-游标的使用"><a href="#2-4-游标的使用" class="headerlink" title="2.4 游标的使用"></a>2.4 游标的使用</h3><p>​    可以认为游标就是一个标识，用来标识数据取到什么地方了。也可以理解为数组下标。</p>
<p>​    游标具有以下特性：只读的，不能更新；不滚动的；不敏感的。</p>
<p>​    游标必须在声明处理程序之前被声明，并且变量和条件必须在声明游标或处理程序之前被声明。</p>
<p>​    <strong>1.声明游标</strong></p>
<p>​    语法格式：<code>declare cursor_name cursor for select_statement</code></p>
<p>​    select_statement是一个select语句，返回的是一行或多行数据。这里的select子句不能有into子句。</p>
<p>​    一个块中的每个游标必须有唯一的名字。</p>
<p>​    <strong>2.打开游标</strong></p>
<p>​    语法格式：<code>open cursor_name</code></p>
<p>​    一个游标可以打开多次。由于表可能更新，每次打开结果可能不同。</p>
<p>​    <strong>3.读取数据</strong></p>
<p>​    语法格式：<code>fetch cursor_name into var_name[,var_name]...</code></p>
<p>​    fetch语句是将游标指向的一行数据赋给一些变量，变量数目要和列的数目相同。</p>
<p>​    <strong>4.关闭游标</strong></p>
<p>​    语法格式：<code>close cursor_name</code></p>
<p>​    例：利用游标读取student表中的总人数，此实例主要为演示游标的使用方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">delimiter ##</span><br><span class="line">create procedure stuCount(out num integer)</span><br><span class="line">begin</span><br><span class="line">declare temp char(20);</span><br><span class="line">declare done int default false;</span><br><span class="line">declare cur cursor for select sno from student;</span><br><span class="line">declare continue handler for not fount set done = true;</span><br><span class="line">set num = 0;</span><br><span class="line">open cur;</span><br><span class="line">read_loop:loop</span><br><span class="line">	fetch cur into temp;</span><br><span class="line">	if done then leave read_loop;</span><br><span class="line">	end if;</span><br><span class="line">	set num = num + 1;</span><br><span class="line">end loop;</span><br><span class="line">close cur;</span><br><span class="line">end ##</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line">set @num=0;</span><br><span class="line">call stuCount(num);</span><br><span class="line">select @num;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-流程的控制"><a href="#2-5-流程的控制" class="headerlink" title="2.5 流程的控制"></a>2.5 流程的控制</h3><p><strong>1.if语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if age&gt;20 then set @count = @count + 1;</span><br><span class="line">elseif age==20 then set @count2 = @count2 + 1;</span><br><span class="line">else set @count3 = @count3 + 1;</span><br><span class="line">end if</span><br></pre></td></tr></table></figure>
<p><strong>2.case语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">case age</span><br><span class="line">	when 20 then set @count1=@count1+1;</span><br><span class="line">	else set @count2=@count2+1;</span><br><span class="line">end case;</span><br></pre></td></tr></table></figure>
<p><strong>3.loop语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[add_num]:loop</span><br><span class="line">set @count=@count+1;</span><br><span class="line">end loop [add_num]</span><br></pre></td></tr></table></figure>
<p>​    add_num是标签，可省略。loop没有停止循环的语句，要结合leave或iterate。</p>
<p><strong>4.leave语句</strong></p>
<p><code>leave label</code>主要用于跳出循环。</p>
<p><strong>5.iterate语句</strong></p>
<p><code>iterate label</code>主要用于跳出本次循环，然后进入下一轮循环。</p>
<p><strong>6.repeat语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repeat</span><br><span class="line">set @num=@num+1;</span><br><span class="line">until @num=10;</span><br><span class="line">end repeat</span><br></pre></td></tr></table></figure>
<p><strong>7.while语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while @num&lt;10 do</span><br><span class="line">set @num=@num+1;</span><br><span class="line">end while</span><br></pre></td></tr></table></figure>
<h3 id="2-6-查看存储过程或函数"><a href="#2-6-查看存储过程或函数" class="headerlink" title="2.6 查看存储过程或函数"></a>2.6 查看存储过程或函数</h3><p><strong>1.查看存储过程或函数的状态</strong></p>
<p><code>show {procedure|function} status [like &#39;pattern&#39;];</code></p>
<p><strong>2.查看存储过程或函数的具体信息</strong></p>
<p><code>show create {procedure|function} sp_name;</code></p>
<p><strong>3.查看所有的存储过程</strong></p>
<p><code>select * from information_schema.routines [where routine_name=&#39;名称&#39;];</code></p>
<h3 id="2-7-修改存储过程或函数"><a href="#2-7-修改存储过程或函数" class="headerlink" title="2.7 修改存储过程或函数"></a>2.7 修改存储过程或函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter pocedure sp_name [characteristc..]</span><br><span class="line">characteristc:&#123;containsSQL|no SQL|reads SQL data|modifies SQL data&#125;|SQL security|&#123;definer|invoker&#125;|comment &apos;string&apos;</span><br></pre></td></tr></table></figure>
<h3 id="2-8-删除存储过程或函数"><a href="#2-8-删除存储过程或函数" class="headerlink" title="2.8 删除存储过程或函数"></a>2.8 删除存储过程或函数</h3><p><code>drop procedure [if exists] sp_name;</code></p>
<p>删除前必须确认该存储过程没有任何依赖关系。</p>
<p>### </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litost-fht.top/2019/01/20/MySQL视图/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fang Hantao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Litost's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/20/MySQL视图/" itemprop="url">MySQL视图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-20T14:42:50+08:00">
                2019-01-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/20/MySQL视图/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/20/MySQL视图/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  914
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-视图"><a href="#1-视图" class="headerlink" title="1.视图"></a>1.视图</h2><h3 id="1-1-视图概述"><a href="#1-1-视图概述" class="headerlink" title="1.1 视图概述"></a>1.1 视图概述</h3><p>​    视图是一个虚拟的表，其内容由查询定义，即视图中的数据并不像表、索引那样需要占用存储空间，视图中保存的仅仅是一条select语句，其数据源来自数据库表或者其他视图。</p>
<h3 id="1-2-视图的优势"><a href="#1-2-视图的优势" class="headerlink" title="1.2 视图的优势"></a>1.2 视图的优势</h3><p>（1）增加数据安全性</p>
<p>（2）提高灵活性，操作变简单</p>
<p>​    对于经常使用但结构复杂的select语句，建议将其封装为一个视图。</p>
<p>（3）提高数据的逻辑独立性</p>
<p>​    应用程序可以建立在视图之上，解耦数据库表和应用程序。</p>
<h3 id="1-3-视图的工作机制"><a href="#1-3-视图的工作机制" class="headerlink" title="1.3 视图的工作机制"></a>1.3 视图的工作机制</h3><p>​    调用视图时，才会执行视图中的SQL语句，进行取数据操作。</p>
<h2 id="2-视图定义和管理"><a href="#2-视图定义和管理" class="headerlink" title="2.视图定义和管理"></a>2.视图定义和管理</h2><h3 id="2-1-创建视图"><a href="#2-1-创建视图" class="headerlink" title="2.1 创建视图"></a>2.1 创建视图</h3><p>​    创建视图需要具有create view的权限，同时应该具有查询涉及的列的select权限。在MySQL数据库下的user表中保存这些权限信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create [algorithm=&#123;undefined|merge|temptable&#125;]</span><br><span class="line">view view_name [(column_list)]</span><br><span class="line">as select_statement</span><br><span class="line">[with [cascaded|local] check option]</span><br></pre></td></tr></table></figure>
<p>1）algorithm是可选参数，表示视图选择的算法。undefined选项表示MySQL自动选择要使用的算法；merge选项表示将使用视图的语句与视图的定义结合起来，使得视图定义的某部分取代语句的对应部分；temptable选项表示将视图的结果存入临时表，然后使用临时表执行语句。</p>
<p>2）cascaded是可选参数，表示更新视图时要满足所有相关视图和表的条件，默认值；local表示更新视图时，要满足视图本身的定义条件即可。</p>
<p>3）with check option是可选参数，表示更新视图时要保证在该视图的权限范围之内。</p>
<p><strong>创建视图时要注意</strong>：</p>
<p>1）创建视图的用户需要具有创建视图（create view）的权限，若加[or replace]，则还需要具有删除视图（drop view）的权限。</p>
<p>2）select语句不能包含from子句中的子查询</p>
<p>3）select语句不能引用系统或用户变量</p>
<p>4）select语句不能引用预处理语句参数</p>
<p>5）在存储子程序内，定义不能引用子程序参数或局部变量</p>
<p>6）在定义中引用的表或视图必须存在</p>
<p>7）在定义中不能引用temporary表，不能创建temporary视图</p>
<p>8）不能将触发程序与视图关联在一起</p>
<p>9）在视图定义中允许使用order by</p>
<h3 id="2-2-删除视图"><a href="#2-2-删除视图" class="headerlink" title="2.2 删除视图"></a>2.2 删除视图</h3><p>删除视图时，只会删除视图的定义，不会删除数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">drop view [if exists]</span><br><span class="line">view_name[,view_name2]...</span><br><span class="line">[restrict | cascade]</span><br></pre></td></tr></table></figure>
<h3 id="2-3-查看视图"><a href="#2-3-查看视图" class="headerlink" title="2.3 查看视图"></a>2.3 查看视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">describe view_name;</span><br><span class="line">show table status like &apos;view_name&apos;</span><br><span class="line">show create view &apos;view_name&apos;</span><br><span class="line">select * from information_schema.views where table_name=&apos;view_name&apos;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-修改视图"><a href="#2-4-修改视图" class="headerlink" title="2.4 修改视图"></a>2.4 修改视图</h3><p><strong>1）create or replace view</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create or replace [algorithm=&#123;undefined|merge|temptable&#125;]</span><br><span class="line">view view_name[(column_list)]</span><br><span class="line">as select_statement</span><br><span class="line">[with [cascaded|local] check option];</span><br></pre></td></tr></table></figure>
<p><strong>2）alter语句：</strong></p>
<h2 id="3-更新视图数据"><a href="#3-更新视图数据" class="headerlink" title="3.更新视图数据"></a>3.更新视图数据</h2><p>​    对视图的更新就是对表的更新，更新视图是通过视图来插入、更新和删除表中的数据。通过视图更新时，都是转换到基本表来更新。更新视图时，只能更新权限范围内的数据。</p>
<p>​    <strong>尽量不要更新视图。</strong>    </p>
<p>以下情况视图无法更新：</p>
<p>1）包含聚集函数</p>
<p>2）包含union、distinct、group by、having等关键字</p>
<p>3）常量视图</p>
<p>4）包含子查询</p>
<p>5）由不可更新的视图导出的视图</p>
<p>6）创建视图时algorithm为temptable类型</p>
<p>7）视图对应的表上存在没有默认值的列，而且该列没有包含在视图中。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://wx4.sinaimg.cn/mw690/adba74c1gy1fy3qlbnbpoj20fi08cq34.jpg" alt="Fang Hantao">
            
              <p class="site-author-name" itemprop="name">Fang Hantao</p>
              <p class="site-description motion-element" itemprop="description">share something</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">136</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">46</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/llitost" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://plus.google.com/yourname" target="_blank" title="Google">
                      
                        <i class="fa fa-fw fa-google"></i>Google</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/yourname" target="_blank" title="FB Page">
                      
                        <i class="fa fa-fw fa-facebook"></i>FB Page</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://youtube.com/yourname" target="_blank" title="YouTube">
                      
                        <i class="fa fa-fw fa-youtube"></i>YouTube</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/yourname" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
            </div>
          

          
          

          
          
<br>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=3950239&auto=1&height=66"></iframe>
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fang Hantao</span>

  
</div>



  <div class="powered-by">
  <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
    本站访客数:<span id="busuanzi_value_site_uv"></span>
  </span>
  </div>
  
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共174.1k字</span>
</div>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    

  




	





  




  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  










  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
